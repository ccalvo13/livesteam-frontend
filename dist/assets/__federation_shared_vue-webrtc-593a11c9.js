import{importShared as Zs}from"./__federation_fn_import.js";const T={};var er=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function tr(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var ve={},Qe={exports:{}};/*! https://mths.be/punycode v1.3.2 by @mathias */Qe.exports;(function(s,e){(function(t){var r=e&&!e.nodeType&&e,n=s&&!s.nodeType&&s,i=typeof globalThis=="object"&&globalThis;(i.global===i||i.window===i||i.self===i)&&(t=i);var o,a=2147483647,h=36,c=1,l=26,u=38,d=700,p=72,v=128,S="-",L=/^xn--/,q=/[^\x20-\x7E]/,m=/[\x2E\u3002\uFF0E\uFF61]/g,f={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},_=h-c,x=Math.floor,O=String.fromCharCode,A;function R(y){throw RangeError(f[y])}function M(y,g){for(var E=y.length,C=[];E--;)C[E]=g(y[E]);return C}function Y(y,g){var E=y.split("@"),C="";E.length>1&&(C=E[0]+"@",y=E[1]),y=y.replace(m,".");var k=y.split("."),F=M(k,g).join(".");return C+F}function ue(y){for(var g=[],E=0,C=y.length,k,F;E<C;)k=y.charCodeAt(E++),k>=55296&&k<=56319&&E<C?(F=y.charCodeAt(E++),(F&64512)==56320?g.push(((k&1023)<<10)+(F&1023)+65536):(g.push(k),E--)):g.push(k);return g}function j(y){return M(y,function(g){var E="";return g>65535&&(g-=65536,E+=O(g>>>10&1023|55296),g=56320|g&1023),E+=O(g),E}).join("")}function Q(y){return y-48<10?y-22:y-65<26?y-65:y-97<26?y-97:h}function oe(y,g){return y+22+75*(y<26)-((g!=0)<<5)}function ae(y,g,E){var C=0;for(y=E?x(y/d):y>>1,y+=x(y/g);y>_*l>>1;C+=h)y=x(y/_);return x(C+(_+1)*y/(y+u))}function V(y){var g=[],E=y.length,C,k=0,F=v,D=p,W,K,ee,he,I,H,X,de,Ee;for(W=y.lastIndexOf(S),W<0&&(W=0),K=0;K<W;++K)y.charCodeAt(K)>=128&&R("not-basic"),g.push(y.charCodeAt(K));for(ee=W>0?W+1:0;ee<E;){for(he=k,I=1,H=h;ee>=E&&R("invalid-input"),X=Q(y.charCodeAt(ee++)),(X>=h||X>x((a-k)/I))&&R("overflow"),k+=X*I,de=H<=D?c:H>=D+l?l:H-D,!(X<de);H+=h)Ee=h-de,I>x(a/Ee)&&R("overflow"),I*=Ee;C=g.length+1,D=ae(k-he,C,he==0),x(k/C)>a-F&&R("overflow"),F+=x(k/C),k%=C,g.splice(k++,0,F)}return j(g)}function Z(y){var g,E,C,k,F,D,W,K,ee,he,I,H=[],X,de,Ee,ct;for(y=ue(y),X=y.length,g=v,E=0,F=p,D=0;D<X;++D)I=y[D],I<128&&H.push(O(I));for(C=k=H.length,k&&H.push(S);C<X;){for(W=a,D=0;D<X;++D)I=y[D],I>=g&&I<W&&(W=I);for(de=C+1,W-g>x((a-E)/de)&&R("overflow"),E+=(W-g)*de,g=W,D=0;D<X;++D)if(I=y[D],I<g&&++E>a&&R("overflow"),I==g){for(K=E,ee=h;he=ee<=F?c:ee>=F+l?l:ee-F,!(K<he);ee+=h)ct=K-he,Ee=h-he,H.push(O(oe(he+ct%Ee,0))),K=x(ct/Ee);H.push(O(oe(K,0))),F=ae(E,de,C==k),E=0,++C}++E,++g}return H.join("")}function at(y){return Y(y,function(g){return L.test(g)?V(g.slice(4).toLowerCase()):g})}function ht(y){return Y(y,function(g){return q.test(g)?"xn--"+Z(g):g})}if(o={version:"1.3.2",ucs2:{decode:ue,encode:j},decode:V,encode:Z,toASCII:ht,toUnicode:at},r&&n)if(s.exports==r)n.exports=o;else for(A in o)o.hasOwnProperty(A)&&(r[A]=o[A]);else t.punycode=o})(er)})(Qe,Qe.exports);var sr=Qe.exports,rr={isString:function(s){return typeof s=="string"},isObject:function(s){return typeof s=="object"&&s!==null},isNull:function(s){return s===null},isNullOrUndefined:function(s){return s==null}},Fe={};function nr(s,e){return Object.prototype.hasOwnProperty.call(s,e)}var ir=function(s,e,t,r){e=e||"&",t=t||"=";var n={};if(typeof s!="string"||s.length===0)return n;var i=/\+/g;s=s.split(e);var o=1e3;r&&typeof r.maxKeys=="number"&&(o=r.maxKeys);var a=s.length;o>0&&a>o&&(a=o);for(var h=0;h<a;++h){var c=s[h].replace(i,"%20"),l=c.indexOf(t),u,d,p,v;l>=0?(u=c.substr(0,l),d=c.substr(l+1)):(u=c,d=""),p=decodeURIComponent(u),v=decodeURIComponent(d),nr(n,p)?Array.isArray(n[p])?n[p].push(v):n[p]=[n[p],v]:n[p]=v}return n},Ae=function(s){switch(typeof s){case"string":return s;case"boolean":return s?"true":"false";case"number":return isFinite(s)?s:"";default:return""}},or=function(s,e,t,r){return e=e||"&",t=t||"=",s===null&&(s=void 0),typeof s=="object"?Object.keys(s).map(function(n){var i=encodeURIComponent(Ae(n))+t;return Array.isArray(s[n])?s[n].map(function(o){return i+encodeURIComponent(Ae(o))}).join(e):i+encodeURIComponent(Ae(s[n]))}).join(e):r?encodeURIComponent(Ae(r))+t+encodeURIComponent(Ae(s)):""};Fe.decode=Fe.parse=ir;Fe.encode=Fe.stringify=or;var ar=sr,se=rr;ve.parse=je;ve.resolve=gr;ve.resolveObject=_r;ve.format=yr;ve.Url=z;function z(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var hr=/^([a-z0-9.+-]+:)/i,cr=/:[0-9]*$/,fr=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,lr=["<",">",'"',"`"," ","\r",`
`,"	"],ur=["{","}","|","\\","^","`"].concat(lr),_t=["'"].concat(ur),Mt=["%","/","?",";","#"].concat(_t),Ft=["/","?","#"],dr=255,$t=/^[+a-z0-9A-Z_-]{0,63}$/,pr=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,mr={javascript:!0,"javascript:":!0},vt={javascript:!0,"javascript:":!0},Ne={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Et=Fe;function je(s,e,t){if(s&&se.isObject(s)&&s instanceof z)return s;var r=new z;return r.parse(s,e,t),r}z.prototype.parse=function(s,e,t){if(!se.isString(s))throw new TypeError("Parameter 'url' must be a string, not "+typeof s);var r=s.indexOf("?"),n=r!==-1&&r<s.indexOf("#")?"?":"#",i=s.split(n),o=/\\/g;i[0]=i[0].replace(o,"/"),s=i.join(n);var a=s;if(a=a.trim(),!t&&s.split("#").length===1){var h=fr.exec(a);if(h)return this.path=a,this.href=a,this.pathname=h[1],h[2]?(this.search=h[2],e?this.query=Et.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var c=hr.exec(a);if(c){c=c[0];var l=c.toLowerCase();this.protocol=l,a=a.substr(c.length)}if(t||c||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var u=a.substr(0,2)==="//";u&&!(c&&vt[c])&&(a=a.substr(2),this.slashes=!0)}if(!vt[c]&&(u||c&&!Ne[c])){for(var d=-1,p=0;p<Ft.length;p++){var v=a.indexOf(Ft[p]);v!==-1&&(d===-1||v<d)&&(d=v)}var S,L;d===-1?L=a.lastIndexOf("@"):L=a.lastIndexOf("@",d),L!==-1&&(S=a.slice(0,L),a=a.slice(L+1),this.auth=decodeURIComponent(S)),d=-1;for(var p=0;p<Mt.length;p++){var v=a.indexOf(Mt[p]);v!==-1&&(d===-1||v<d)&&(d=v)}d===-1&&(d=a.length),this.host=a.slice(0,d),a=a.slice(d),this.parseHost(),this.hostname=this.hostname||"";var q=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!q)for(var m=this.hostname.split(/\./),p=0,f=m.length;p<f;p++){var _=m[p];if(_&&!_.match($t)){for(var x="",O=0,A=_.length;O<A;O++)_.charCodeAt(O)>127?x+="x":x+=_[O];if(!x.match($t)){var R=m.slice(0,p),M=m.slice(p+1),Y=_.match(pr);Y&&(R.push(Y[1]),M.unshift(Y[2])),M.length&&(a="/"+M.join(".")+a),this.hostname=R.join(".");break}}}this.hostname.length>dr?this.hostname="":this.hostname=this.hostname.toLowerCase(),q||(this.hostname=ar.toASCII(this.hostname));var ue=this.port?":"+this.port:"",j=this.hostname||"";this.host=j+ue,this.href+=this.host,q&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!mr[l])for(var p=0,f=_t.length;p<f;p++){var Q=_t[p];if(a.indexOf(Q)!==-1){var oe=encodeURIComponent(Q);oe===Q&&(oe=escape(Q)),a=a.split(Q).join(oe)}}var ae=a.indexOf("#");ae!==-1&&(this.hash=a.substr(ae),a=a.slice(0,ae));var V=a.indexOf("?");if(V!==-1?(this.search=a.substr(V),this.query=a.substr(V+1),e&&(this.query=Et.parse(this.query)),a=a.slice(0,V)):e&&(this.search="",this.query={}),a&&(this.pathname=a),Ne[l]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var ue=this.pathname||"",Z=this.search||"";this.path=ue+Z}return this.href=this.format(),this};function yr(s){return se.isString(s)&&(s=je(s)),s instanceof z?s.format():z.prototype.format.call(s)}z.prototype.format=function(){var s=this.auth||"";s&&(s=encodeURIComponent(s),s=s.replace(/%3A/i,":"),s+="@");var e=this.protocol||"",t=this.pathname||"",r=this.hash||"",n=!1,i="";this.host?n=s+this.host:this.hostname&&(n=s+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&se.isObject(this.query)&&Object.keys(this.query).length&&(i=Et.stringify(this.query));var o=this.search||i&&"?"+i||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||Ne[e])&&n!==!1?(n="//"+(n||""),t&&t.charAt(0)!=="/"&&(t="/"+t)):n||(n=""),r&&r.charAt(0)!=="#"&&(r="#"+r),o&&o.charAt(0)!=="?"&&(o="?"+o),t=t.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),o=o.replace("#","%23"),e+n+t+o+r};function gr(s,e){return je(s,!1,!0).resolve(e)}z.prototype.resolve=function(s){return this.resolveObject(je(s,!1,!0)).format()};function _r(s,e){return s?je(s,!1,!0).resolveObject(e):e}z.prototype.resolveObject=function(s){if(se.isString(s)){var e=new z;e.parse(s,!1,!0),s=e}for(var t=new z,r=Object.keys(this),n=0;n<r.length;n++){var i=r[n];t[i]=this[i]}if(t.hash=s.hash,s.href==="")return t.href=t.format(),t;if(s.slashes&&!s.protocol){for(var o=Object.keys(s),a=0;a<o.length;a++){var h=o[a];h!=="protocol"&&(t[h]=s[h])}return Ne[t.protocol]&&t.hostname&&!t.pathname&&(t.path=t.pathname="/"),t.href=t.format(),t}if(s.protocol&&s.protocol!==t.protocol){if(!Ne[s.protocol]){for(var c=Object.keys(s),l=0;l<c.length;l++){var u=c[l];t[u]=s[u]}return t.href=t.format(),t}if(t.protocol=s.protocol,!s.host&&!vt[s.protocol]){for(var f=(s.pathname||"").split("/");f.length&&!(s.host=f.shift()););s.host||(s.host=""),s.hostname||(s.hostname=""),f[0]!==""&&f.unshift(""),f.length<2&&f.unshift(""),t.pathname=f.join("/")}else t.pathname=s.pathname;if(t.search=s.search,t.query=s.query,t.host=s.host||"",t.auth=s.auth,t.hostname=s.hostname||s.host,t.port=s.port,t.pathname||t.search){var d=t.pathname||"",p=t.search||"";t.path=d+p}return t.slashes=t.slashes||s.slashes,t.href=t.format(),t}var v=t.pathname&&t.pathname.charAt(0)==="/",S=s.host||s.pathname&&s.pathname.charAt(0)==="/",L=S||v||t.host&&s.pathname,q=L,m=t.pathname&&t.pathname.split("/")||[],f=s.pathname&&s.pathname.split("/")||[],_=t.protocol&&!Ne[t.protocol];if(_&&(t.hostname="",t.port=null,t.host&&(m[0]===""?m[0]=t.host:m.unshift(t.host)),t.host="",s.protocol&&(s.hostname=null,s.port=null,s.host&&(f[0]===""?f[0]=s.host:f.unshift(s.host)),s.host=null),L=L&&(f[0]===""||m[0]==="")),S)t.host=s.host||s.host===""?s.host:t.host,t.hostname=s.hostname||s.hostname===""?s.hostname:t.hostname,t.search=s.search,t.query=s.query,m=f;else if(f.length)m||(m=[]),m.pop(),m=m.concat(f),t.search=s.search,t.query=s.query;else if(!se.isNullOrUndefined(s.search)){if(_){t.hostname=t.host=m.shift();var x=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;x&&(t.auth=x.shift(),t.host=t.hostname=x.shift())}return t.search=s.search,t.query=s.query,(!se.isNull(t.pathname)||!se.isNull(t.search))&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.href=t.format(),t}if(!m.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var O=m.slice(-1)[0],A=(t.host||s.host||m.length>1)&&(O==="."||O==="..")||O==="",R=0,M=m.length;M>=0;M--)O=m[M],O==="."?m.splice(M,1):O===".."?(m.splice(M,1),R++):R&&(m.splice(M,1),R--);if(!L&&!q)for(;R--;R)m.unshift("..");L&&m[0]!==""&&(!m[0]||m[0].charAt(0)!=="/")&&m.unshift(""),A&&m.join("/").substr(-1)!=="/"&&m.push("");var Y=m[0]===""||m[0]&&m[0].charAt(0)==="/";if(_){t.hostname=t.host=Y?"":m.length?m.shift():"";var x=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;x&&(t.auth=x.shift(),t.host=t.hostname=x.shift())}return L=L||t.host&&m.length,L&&!Y&&m.unshift(""),m.length?t.pathname=m.join("/"):(t.pathname=null,t.path=null),(!se.isNull(t.pathname)||!se.isNull(t.search))&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.auth=s.auth||t.auth,t.slashes=t.slashes||s.slashes,t.href=t.format(),t};z.prototype.parseHost=function(){var s=this.host,e=cr.exec(s);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),s=s.substr(0,s.length-e.length)),s&&(this.hostname=s)};var Nt={exports:{}},ke=typeof Reflect=="object"?Reflect:null,jt=ke&&typeof ke.apply=="function"?ke.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},He;ke&&typeof ke.ownKeys=="function"?He=ke.ownKeys:Object.getOwnPropertySymbols?He=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:He=function(e){return Object.getOwnPropertyNames(e)};function vr(s){console&&console.warn&&console.warn(s)}var ys=Number.isNaN||function(e){return e!==e};function N(){N.init.call(this)}Nt.exports=N;Nt.exports.once=wr;N.EventEmitter=N;N.prototype._events=void 0;N.prototype._eventsCount=0;N.prototype._maxListeners=void 0;var qt=10;function st(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof s)}Object.defineProperty(N,"defaultMaxListeners",{enumerable:!0,get:function(){return qt},set:function(s){if(typeof s!="number"||s<0||ys(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");qt=s}});N.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};N.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||ys(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function gs(s){return s._maxListeners===void 0?N.defaultMaxListeners:s._maxListeners}N.prototype.getMaxListeners=function(){return gs(this)};N.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n=e==="error",i=this._events;if(i!==void 0)n=n&&i.error===void 0;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var h=i[e];if(h===void 0)return!1;if(typeof h=="function")jt(h,this,t);else for(var c=h.length,l=xs(h,c),r=0;r<c;++r)jt(l[r],this,t);return!0};function _s(s,e,t,r){var n,i,o;if(st(t),i=s._events,i===void 0?(i=s._events=Object.create(null),s._eventsCount=0):(i.newListener!==void 0&&(s.emit("newListener",e,t.listener?t.listener:t),i=s._events),o=i[e]),o===void 0)o=i[e]=t,++s._eventsCount;else if(typeof o=="function"?o=i[e]=r?[t,o]:[o,t]:r?o.unshift(t):o.push(t),n=gs(s),n>0&&o.length>n&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=s,a.type=e,a.count=o.length,vr(a)}return s}N.prototype.addListener=function(e,t){return _s(this,e,t,!1)};N.prototype.on=N.prototype.addListener;N.prototype.prependListener=function(e,t){return _s(this,e,t,!0)};function Er(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function vs(s,e,t){var r={fired:!1,wrapFn:void 0,target:s,type:e,listener:t},n=Er.bind(r);return n.listener=t,r.wrapFn=n,n}N.prototype.once=function(e,t){return st(t),this.on(e,vs(this,e,t)),this};N.prototype.prependOnceListener=function(e,t){return st(t),this.prependListener(e,vs(this,e,t)),this};N.prototype.removeListener=function(e,t){var r,n,i,o,a;if(st(t),n=this._events,n===void 0)return this;if(r=n[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){a=r[o].listener,i=o;break}if(i<0)return this;i===0?r.shift():br(r,i),r.length===1&&(n[e]=r[0]),n.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};N.prototype.off=N.prototype.removeListener;N.prototype.removeAllListeners=function(e){var t,r,n;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var i=Object.keys(r),o;for(n=0;n<i.length;++n)o=i[n],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this};function Es(s,e,t){var r=s._events;if(r===void 0)return[];var n=r[e];return n===void 0?[]:typeof n=="function"?t?[n.listener||n]:[n]:t?xr(n):xs(n,n.length)}N.prototype.listeners=function(e){return Es(this,e,!0)};N.prototype.rawListeners=function(e){return Es(this,e,!1)};N.listenerCount=function(s,e){return typeof s.listenerCount=="function"?s.listenerCount(e):bs.call(s,e)};N.prototype.listenerCount=bs;function bs(s){var e=this._events;if(e!==void 0){var t=e[s];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}N.prototype.eventNames=function(){return this._eventsCount>0?He(this._events):[]};function xs(s,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=s[r];return t}function br(s,e){for(;e+1<s.length;e++)s[e]=s[e+1];s.pop()}function xr(s){for(var e=new Array(s.length),t=0;t<e.length;++t)e[t]=s[t].listener||s[t];return e}function wr(s,e){return new Promise(function(t,r){function n(o){s.removeListener(e,i),r(o)}function i(){typeof s.removeListener=="function"&&s.removeListener("error",n),t([].slice.call(arguments))}ws(s,e,i,{once:!0}),e!=="error"&&Sr(s,n,{once:!0})})}function Sr(s,e,t){typeof s.on=="function"&&ws(s,"error",e,t)}function ws(s,e,t,r){if(typeof s.on=="function")r.once?s.once(e,t):s.on(e,t);else if(typeof s.addEventListener=="function")s.addEventListener(e,function n(i){r.once&&s.removeEventListener(e,n),t(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof s)}var Or=Nt.exports;const Ss=tr(Or),{defineComponent:Os,openBlock:Ge,createElementBlock:ze,Fragment:Cr,renderList:Tr,createElementVNode:pe,createTextVNode:Cs,toDisplayString:Vt}=await Zs("vue");function Nr(s,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in s)){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(s,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}})}),Object.freeze(s)}var kr=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Lr=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],bt=function(e){var t=e,r=e.indexOf("["),n=e.indexOf("]");r!=-1&&n!=-1&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));for(var i=kr.exec(e||""),o={},a=14;a--;)o[Lr[a]]=i[a]||"";return r!=-1&&n!=-1&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=Rr(o,o.path),o.queryKey=Ar(o,o.query),o};function Rr(s,e){var t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.substr(0,1)=="/"||e.length===0)&&r.splice(0,1),e.substr(e.length-1,1)=="/"&&r.splice(r.length-1,1),r}function Ar(s,e){var t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,n,i){n&&(t[n]=i)}),t}function Pr(s,e="",t){let r=s;t=t||typeof location<"u"&&location,s==null&&(s=t.protocol+"//"+t.host),typeof s=="string"&&(s.charAt(0)==="/"&&(s.charAt(1)==="/"?s=t.protocol+s:s=t.host+s),/^(https?|wss?):\/\//.test(s)||(typeof t<"u"?s=t.protocol+"//"+s:s="https://"+s),r=bt(s)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}/**
 * Wrapper for built-in http.js to emulate the browser XMLHttpRequest object.
 *
 * This can be used with JS designed for browsers to improve reuse of code and
 * allow the use of existing libraries.
 *
 * Usage: include("XMLHttpRequest.js") and use XMLHttpRequest per W3C specs.
 *
 * @author Dan DeFelippi <dan@driverdan.com>
 * @contributor David Ellis <d.f.ellis@ieee.org>
 * @license MIT
 */var Br=T.spawn,Ye=xt;xt.XMLHttpRequest=xt;function xt(s){s=s||{};var e=this,t=T,r=T,n,i,o={},a=!1,h={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},c=Object.assign({},h),l=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],u=["TRACE","TRACK","CONNECT"],d=!1,p=!1,v=!1,S={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseText="",this.responseXML="",this.status=null,this.statusText=null;var L=function(f){return a||f&&l.indexOf(f.toLowerCase())===-1},q=function(f){return f&&u.indexOf(f)===-1};this.open=function(f,_,x,O,A){if(this.abort(),p=!1,v=!1,!q(f))throw new Error("SecurityError: Request method not allowed");o={method:f,url:_.toString(),async:typeof x!="boolean"?!0:x,user:O||null,password:A||null},m(this.OPENED)},this.setDisableHeaderCheck=function(f){a=f},this.setRequestHeader=function(f,_){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN");if(!L(f))return console.warn('Refused to set unsafe header "'+f+'"'),!1;if(d)throw new Error("INVALID_STATE_ERR: send flag is true");return c[f]=_,!0},this.getResponseHeader=function(f){return typeof f=="string"&&this.readyState>this.OPENED&&i.headers[f.toLowerCase()]&&!p?i.headers[f.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||p)return"";var f="";for(var _ in i.headers)_!=="set-cookie"&&_!=="set-cookie2"&&(f+=_+": "+i.headers[_]+`\r
`);return f.substr(0,f.length-2)},this.getRequestHeader=function(f){return typeof f=="string"&&c[f]?c[f]:""},this.send=function(f){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: connection must be opened before send() is called");if(d)throw new Error("INVALID_STATE_ERR: send has already been called");var _=!1,x=!1,O=ve.parse(o.url),A;switch(O.protocol){case"https:":_=!0;case"http:":A=O.hostname;break;case"file:":x=!0;break;case void 0:case"":A="localhost";break;default:throw new Error("Protocol not supported.")}if(x){if(o.method!=="GET")throw new Error("XMLHttpRequest: Only GET method is supported");if(o.async)T.readFile(unescape(O.pathname),"utf8",function(g,E){g?e.handleError(g,g.errno||-1):(e.status=200,e.responseText=E,m(e.DONE))});else try{this.responseText=T.readFileSync(unescape(O.pathname),"utf8"),this.status=200,m(e.DONE)}catch(g){this.handleError(g,g.errno||-1)}return}var R=O.port||(_?443:80),M=O.pathname+(O.search?O.search:"");if(c.Host=A,_&&R===443||R===80||(c.Host+=":"+O.port),o.user){typeof o.password>"u"&&(o.password="");var Y=new Buffer(o.user+":"+o.password);c.Authorization="Basic "+Y.toString("base64")}o.method==="GET"||o.method==="HEAD"?f=null:f?(c["Content-Length"]=Buffer.isBuffer(f)?f.length:Buffer.byteLength(f),c["Content-Type"]||(c["Content-Type"]="text/plain;charset=UTF-8")):o.method==="POST"&&(c["Content-Length"]=0);var ue=s.agent||!1,j={host:A,port:R,path:M,method:o.method,headers:c,agent:ue};if(_&&(j.pfx=s.pfx,j.key=s.key,j.passphrase=s.passphrase,j.cert=s.cert,j.ca=s.ca,j.ciphers=s.ciphers,j.rejectUnauthorized=s.rejectUnauthorized!==!1),p=!1,o.async){var Q=_?r.request:t.request;d=!0,e.dispatchEvent("readystatechange");var oe=function(g){if(i=g,i.statusCode===302||i.statusCode===303||i.statusCode===307){o.url=i.headers.location;var E=ve.parse(o.url);A=E.hostname;var C={hostname:E.hostname,port:E.port,path:E.path,method:i.statusCode===303?"GET":o.method,headers:c};_&&(C.pfx=s.pfx,C.key=s.key,C.passphrase=s.passphrase,C.cert=s.cert,C.ca=s.ca,C.ciphers=s.ciphers,C.rejectUnauthorized=s.rejectUnauthorized!==!1),n=Q(C,oe).on("error",ae),n.end();return}i&&i.setEncoding&&i.setEncoding("utf8"),m(e.HEADERS_RECEIVED),e.status=i.statusCode,i.on("data",function(k){k&&(e.responseText+=k),d&&m(e.LOADING)}),i.on("end",function(){d&&(d=!1,m(e.DONE))}),i.on("error",function(k){e.handleError(k)})},ae=function(g){e.handleError(g)};n=Q(j,oe).on("error",ae),s.autoUnref&&n.on("socket",g=>{g.unref()}),f&&n.write(f),n.end(),e.dispatchEvent("loadstart")}else{var V=".node-xmlhttprequest-content-"+process.pid,Z=".node-xmlhttprequest-sync-"+process.pid;T.writeFileSync(Z,"","utf8");for(var at="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+(_?"s":"")+".request;var options = "+JSON.stringify(j)+";var responseText = '';var req = doRequest(options, function(response) {response.setEncoding('utf8');response.on('data', function(chunk) {  responseText += chunk;});response.on('end', function() {fs.writeFileSync('"+V+"', 'NODE-XMLHTTPREQUEST-STATUS:' + response.statusCode + ',' + responseText, 'utf8');fs.unlinkSync('"+Z+"');});response.on('error', function(error) {fs.writeFileSync('"+V+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+Z+"');});}).on('error', function(error) {fs.writeFileSync('"+V+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+Z+"');});"+(f?"req.write('"+JSON.stringify(f).slice(1,-1).replace(/'/g,"\\'")+"');":"")+"req.end();",ht=Br(process.argv[0],["-e",at]);T.existsSync(Z););if(e.responseText=T.readFileSync(V,"utf8"),ht.stdin.end(),T.unlinkSync(V),e.responseText.match(/^NODE-XMLHTTPREQUEST-ERROR:/)){var y=e.responseText.replace(/^NODE-XMLHTTPREQUEST-ERROR:/,"");e.handleError(y,503)}else e.status=e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:([0-9]*),.*/,"$1"),e.responseText=e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:[0-9]*,(.*)/,"$1"),m(e.DONE)}},this.handleError=function(f,_){this.status=_||0,this.statusText=f,this.responseText=f.stack,p=!0,m(this.DONE)},this.abort=function(){n&&(n.abort(),n=null),c=Object.assign({},h),this.responseText="",this.responseXML="",p=v=!0,this.readyState!==this.UNSENT&&(this.readyState!==this.OPENED||d)&&this.readyState!==this.DONE&&(d=!1,m(this.DONE)),this.readyState=this.UNSENT},this.addEventListener=function(f,_){f in S||(S[f]=[]),S[f].push(_)},this.removeEventListener=function(f,_){f in S&&(S[f]=S[f].filter(function(x){return x!==_}))},this.dispatchEvent=function(f){if(typeof e["on"+f]=="function"&&(this.readyState===this.DONE?setImmediate(function(){e["on"+f]()}):e["on"+f]()),f in S)for(let _=0,x=S[f].length;_<x;_++)this.readyState===this.DONE?setImmediate(function(){S[f][_].call(e)}):S[f][_].call(e)};var m=function(f){if(!(e.readyState===f||e.readyState===e.UNSENT&&v)&&(e.readyState=f,(o.async||e.readyState<e.OPENED||e.readyState===e.DONE)&&e.dispatchEvent("readystatechange"),e.readyState===e.DONE)){let _;v?_="abort":p?_="error":_="load",e.dispatchEvent(_),e.dispatchEvent("loadend")}}}var Dr=Object.freeze(Nr({__proto__:null,default:Ye,__moduleExports:Ye},[Ye]));const Ts=Ye||Dr;var Ce=Ce;function Ns(s,...e){return e.reduce((t,r)=>(s.hasOwnProperty(r)&&(t[r]=s[r]),t),{})}const Ir=setTimeout,Ur=clearTimeout;function rt(s,e){e.useNativeTimers?(s.setTimeoutFn=Ir.bind(Ce),s.clearTimeoutFn=Ur.bind(Ce)):(s.setTimeoutFn=setTimeout.bind(Ce),s.clearTimeoutFn=clearTimeout.bind(Ce))}var Le=$;function $(s){if(s)return Mr(s)}function Mr(s){for(var e in $.prototype)s[e]=$.prototype[e];return s}$.prototype.on=$.prototype.addEventListener=function(s,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+s]=this._callbacks["$"+s]||[]).push(e),this};$.prototype.once=function(s,e){function t(){this.off(s,t),e.apply(this,arguments)}return t.fn=e,this.on(s,t),this};$.prototype.off=$.prototype.removeListener=$.prototype.removeAllListeners=$.prototype.removeEventListener=function(s,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+s];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+s],this;for(var r,n=0;n<t.length;n++)if(r=t[n],r===e||r.fn===e){t.splice(n,1);break}return t.length===0&&delete this._callbacks["$"+s],this};$.prototype.emit=function(s){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+s],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,n=t.length;r<n;++r)t[r].apply(this,e)}return this};$.prototype.emitReserved=$.prototype.emit;$.prototype.listeners=function(s){return this._callbacks=this._callbacks||{},this._callbacks["$"+s]||[]};$.prototype.hasListeners=function(s){return!!this.listeners(s).length};const ne=Object.create(null);ne.open="0";ne.close="1";ne.ping="2";ne.pong="3";ne.message="4";ne.upgrade="5";ne.noop="6";const Ke=Object.create(null);Object.keys(ne).forEach(s=>{Ke[ne[s]]=s});const Fr={type:"error",data:"parser error"},ks=({type:s,data:e},t,r)=>{if(e instanceof ArrayBuffer||ArrayBuffer.isView(e)){const n=$r(e);return r(jr(n,t))}return r(ne[s]+(e||""))},$r=s=>Buffer.isBuffer(s)?s:s instanceof ArrayBuffer?Buffer.from(s):Buffer.from(s.buffer,s.byteOffset,s.byteLength),jr=(s,e)=>e?s:"b"+s.toString("base64"),Ls=(s,e)=>{if(typeof s!="string")return{type:"message",data:Wt(s,e)};const t=s.charAt(0);if(t==="b"){const r=Buffer.from(s.substring(1),"base64");return{type:"message",data:Wt(r,e)}}return Ke[t]?s.length>1?{type:Ke[t],data:s.substring(1)}:{type:Ke[t]}:Fr},Wt=(s,e)=>{const t=Buffer.isBuffer(s);switch(e){case"arraybuffer":return t?qr(s):s;case"nodebuffer":default:return s}},qr=s=>{const e=new ArrayBuffer(s.length),t=new Uint8Array(e);for(let r=0;r<s.length;r++)t[r]=s[r];return e},Rs=String.fromCharCode(30),Vr=(s,e)=>{const t=s.length,r=new Array(t);let n=0;s.forEach((i,o)=>{ks(i,!1,a=>{r[o]=a,++n===t&&e(r.join(Rs))})})},Wr=(s,e)=>{const t=s.split(Rs),r=[];for(let n=0;n<t.length;n++){const i=Ls(t[n],e);if(r.push(i),i.type==="error")break}return r},As=4;class Ps extends Le{constructor(e){super(),this.writable=!1,rt(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t){const r=new Error(e);return r.type="TransportError",r.description=t,super.emit("error",r),this}open(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emit("open")}onData(e){const t=Ls(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emit("packet",e)}onClose(){this.readyState="closed",super.emit("close")}}var Bs="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Ze=64,Ds={},Ht=0,_e=0,Gt;function wt(s){var e="";do e=Bs[s%Ze]+e,s=Math.floor(s/Ze);while(s>0);return e}function Hr(s){var e=0;for(_e=0;_e<s.length;_e++)e=e*Ze+Ds[s.charAt(_e)];return e}function kt(){var s=wt(+new Date);return s!==Gt?(Ht=0,Gt=s):s+"."+wt(Ht++)}for(;_e<Ze;_e++)Ds[Bs[_e]]=_e;kt.encode=wt;kt.decode=Hr;var Is=kt,Gr=function(s){var e="";for(var t in s)s.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(s[t]));return e},zr=function(s){for(var e={},t=s.split("&"),r=0,n=t.length;r<n;r++){var i=t[r].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e},Lt={encode:Gr,decode:zr};class Yr extends Ps{constructor(){super(...arguments),this.polling=!1}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emit("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose(),!1;this.onPacket(r)};Wr(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emit("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Vr(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emit("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Is()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const n=Lt.encode(e),i=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(i?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}}function Kr(){}const Xr=function(){return new Ts({xdomain:!1}).responseType!=null}();class Jr extends Yr{constructor(e){if(super(e),typeof location<"u"){const r=location.protocol==="https:";let n=location.port;n||(n=r?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==r}const t=e&&e.forceBase64;this.supportsBinary=Xr&&!t}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new re(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",n=>{this.onError("xhr post error",n)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",t=>{this.onError("xhr poll error",t)}),this.pollXhr=e}}class re extends Le{constructor(e,t){super(),rt(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=Ns(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new Ts(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.opts.extraHeaders[r])}}catch{}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{t.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document<"u"&&(this.index=re.requestsCount++,re.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(e){this.emit("data",e),this.onSuccess()}onError(e){this.emit("error",e),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Kr,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete re.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&this.onData(e)}abort(){this.cleanup()}}re.requestsCount=0;re.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",zt);else if(typeof addEventListener=="function"){const s="onpagehide"in Ce?"pagehide":"unload";addEventListener(s,zt,!1)}}function zt(){for(let s in re.requests)re.requests.hasOwnProperty(s)&&re.requests[s].abort()}function Us(s,e,t){return t={path:e,exports:{},require:function(r,n){return Qr(r,n??t.path)}},s(t,t.exports),t.exports}function Qr(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var we={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}},$e=Us(function(s){const{EMPTY_BUFFER:e}=we;function t(a,h){if(a.length===0)return e;if(a.length===1)return a[0];const c=Buffer.allocUnsafe(h);let l=0;for(let u=0;u<a.length;u++){const d=a[u];c.set(d,l),l+=d.length}return l<h?c.slice(0,l):c}function r(a,h,c,l,u){for(let d=0;d<u;d++)c[l+d]=a[d]^h[d&3]}function n(a,h){for(let c=0;c<a.length;c++)a[c]^=h[c&3]}function i(a){return a.byteLength===a.buffer.byteLength?a.buffer:a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)}function o(a){if(o.readOnly=!0,Buffer.isBuffer(a))return a;let h;return a instanceof ArrayBuffer?h=Buffer.from(a):ArrayBuffer.isView(a)?h=Buffer.from(a.buffer,a.byteOffset,a.byteLength):(h=Buffer.from(a),o.readOnly=!1),h}try{const a=require("bufferutil");s.exports={concat:t,mask(h,c,l,u,d){d<48?r(h,c,l,u,d):a.mask(h,c,l,u,d)},toArrayBuffer:i,toBuffer:o,unmask(h,c){h.length<32?n(h,c):a.unmask(h,c)}}}catch{s.exports={concat:t,mask:r,toArrayBuffer:i,toBuffer:o,unmask:n}}});const Yt=Symbol("kDone"),ft=Symbol("kRun");class Zr{constructor(e){this[Yt]=()=>{this.pending--,this[ft]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[ft]()}[ft](){if(this.pending!==this.concurrency&&this.jobs.length){const e=this.jobs.shift();this.pending++,e(this[Yt])}}}var en=Zr;const{kStatusCode:Ms}=we,tn=Buffer.from([0,0,255,255]),et=Symbol("permessage-deflate"),fe=Symbol("total-length"),Me=Symbol("callback"),me=Symbol("buffers"),Xe=Symbol("error");let Ve;class sn{constructor(e,t,r){if(this._maxPayload=r|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!Ve){const n=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Ve=new en(n)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[Me];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,r=e.find(n=>!(t.serverNoContextTakeover===!1&&n.server_no_context_takeover||n.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>n.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!n.client_max_window_bits));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(r.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?r.client_max_window_bits=t.clientMaxWindowBits:(r.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete r.client_max_window_bits,r}acceptAsClient(e){const t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(r=>{let n=t[r];if(n.length>1)throw new Error(`Parameter "${r}" must have only a single value`);if(n=n[0],r==="client_max_window_bits"){if(n!==!0){const i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${r}": ${n}`);n=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${r}": ${n}`)}else if(r==="server_max_window_bits"){const i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${r}": ${n}`);n=i}else if(r==="client_no_context_takeover"||r==="server_no_context_takeover"){if(n!==!0)throw new TypeError(`Invalid value for parameter "${r}": ${n}`)}else throw new Error(`Unknown parameter "${r}"`);t[r]=n})}),e}decompress(e,t,r){Ve.add(n=>{this._decompress(e,t,(i,o)=>{n(),r(i,o)})})}compress(e,t,r){Ve.add(n=>{this._compress(e,t,(i,o)=>{n(),r(i,o)})})}_decompress(e,t,r){const n=this._isServer?"client":"server";if(!this._inflate){const i=`${n}_max_window_bits`,o=typeof this.params[i]!="number"?T.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=T.createInflateRaw({...this._options.zlibInflateOptions,windowBits:o}),this._inflate[et]=this,this._inflate[fe]=0,this._inflate[me]=[],this._inflate.on("error",nn),this._inflate.on("data",Fs)}this._inflate[Me]=r,this._inflate.write(e),t&&this._inflate.write(tn),this._inflate.flush(()=>{const i=this._inflate[Xe];if(i){this._inflate.close(),this._inflate=null,r(i);return}const o=$e.concat(this._inflate[me],this._inflate[fe]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[fe]=0,this._inflate[me]=[],t&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),r(null,o)})}_compress(e,t,r){const n=this._isServer?"server":"client";if(!this._deflate){const i=`${n}_max_window_bits`,o=typeof this.params[i]!="number"?T.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=T.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:o}),this._deflate[fe]=0,this._deflate[me]=[],this._deflate.on("data",rn)}this._deflate[Me]=r,this._deflate.write(e),this._deflate.flush(T.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=$e.concat(this._deflate[me],this._deflate[fe]);t&&(i=i.slice(0,i.length-4)),this._deflate[Me]=null,this._deflate[fe]=0,this._deflate[me]=[],t&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),r(null,i)})}}var B=sn;function rn(s){this[me].push(s),this[fe]+=s.length}function Fs(s){if(this[fe]+=s.length,this[et]._maxPayload<1||this[fe]<=this[et]._maxPayload){this[me].push(s);return}this[Xe]=new RangeError("Max payload size exceeded"),this[Xe].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Xe][Ms]=1009,this.removeListener("data",Fs),this.reset()}function nn(s){this[et]._inflate=null,s[Ms]=1007,this[Me](s)}var nt=Us(function(s){const e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function t(n){return n>=1e3&&n<=1014&&n!==1004&&n!==1005&&n!==1006||n>=3e3&&n<=4999}function r(n){const i=n.length;let o=0;for(;o<i;)if(!(n[o]&128))o++;else if((n[o]&224)===192){if(o+1===i||(n[o+1]&192)!==128||(n[o]&254)===192)return!1;o+=2}else if((n[o]&240)===224){if(o+2>=i||(n[o+1]&192)!==128||(n[o+2]&192)!==128||n[o]===224&&(n[o+1]&224)===128||n[o]===237&&(n[o+1]&224)===160)return!1;o+=3}else if((n[o]&248)===240){if(o+3>=i||(n[o+1]&192)!==128||(n[o+2]&192)!==128||(n[o+3]&192)!==128||n[o]===240&&(n[o+1]&240)===128||n[o]===244&&n[o+1]>143||n[o]>244)return!1;o+=4}else return!1;return!0}try{const n=require("utf-8-validate");s.exports={isValidStatusCode:t,isValidUTF8(i){return i.length<150?r(i):n(i)},tokenChars:e}}catch{s.exports={isValidStatusCode:t,isValidUTF8:r,tokenChars:e}}});const{Writable:on}=T,{BINARY_TYPES:an,EMPTY_BUFFER:Kt,kStatusCode:hn,kWebSocket:cn}=we,{concat:lt,toArrayBuffer:fn,unmask:ln}=$e,{isValidStatusCode:un,isValidUTF8:Xt}=nt,Pe=0,Jt=1,Qt=2,Zt=3,ut=4,dn=5;class pn extends on{constructor(e={}){super(),this._binaryType=e.binaryType||an[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[cn]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=Pe,this._loop=!1}_write(e,t,r){if(this._opcode===8&&this._state==Pe)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const r=this._buffers[0];return this._buffers[0]=r.slice(e),r.slice(0,e)}const t=Buffer.allocUnsafe(e);do{const r=this._buffers[0],n=t.length-e;e>=r.length?t.set(this._buffers.shift(),n):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),n),this._buffers[0]=r.slice(e)),e-=r.length}while(e>0);return t}startLoop(e){let t;this._loop=!0;do switch(this._state){case Pe:t=this.getInfo();break;case Jt:t=this.getPayloadLength16();break;case Qt:t=this.getPayloadLength64();break;case Zt:this.getMask();break;case ut:t=this.getData(e);break;default:this._loop=!1;return}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}const e=this.consume(2);if(e[0]&48)return this._loop=!1,P(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");const t=(e[0]&64)===64;if(t&&!this._extensions[B.extensionName])return this._loop=!1,P(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(t)return this._loop=!1,P(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,P(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,P(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=t}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,P(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(t)return this._loop=!1,P(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125)return this._loop=!1,P(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}else return this._loop=!1,P(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._isServer){if(!this._masked)return this._loop=!1,P(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,P(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(this._payloadLength===126)this._state=Jt;else if(this._payloadLength===127)this._state=Qt;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}const e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,53-32)-1?(this._loop=!1,P(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,P(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=Zt:this._state=ut}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=ut}getData(e){let t=Kt;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&ln(t,this._mask)}if(this._opcode>7)return this.controlMessage(t);if(this._compressed){this._state=dn,this.decompress(t,e);return}return t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage()}decompress(e,t){this._extensions[B.extensionName].decompress(e,this._fin,(n,i)=>{if(n)return t(n);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(P(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(i)}const o=this.dataMessage();if(o)return t(o);this.startLoop(t)})}dataMessage(){if(this._fin){const e=this._messageLength,t=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let r;this._binaryType==="nodebuffer"?r=lt(t,e):this._binaryType==="arraybuffer"?r=fn(lt(t,e)):r=t,this.emit("message",r,!0)}else{const r=lt(t,e);if(!this._skipUTF8Validation&&!Xt(r))return this._loop=!1,P(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",r,!1)}}this._state=Pe}controlMessage(e){if(this._opcode===8)if(this._loop=!1,e.length===0)this.emit("conclude",1005,Kt),this.end();else{if(e.length===1)return P(RangeError,"invalid payload length 1",!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");{const t=e.readUInt16BE(0);if(!un(t))return P(RangeError,`invalid status code ${t}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");const r=e.slice(2);if(!this._skipUTF8Validation&&!Xt(r))return P(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",t,r),this.end()}}else this._opcode===9?this.emit("ping",e):this.emit("pong",e);this._state=Pe}}var $s=pn;function P(s,e,t,r,n){const i=new s(t?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(i,P),i.code=n,i[hn]=r,i}const{randomFillSync:mn}=T,{EMPTY_BUFFER:yn}=we,{isValidStatusCode:gn}=nt,{mask:es,toBuffer:ce}=$e,be=Buffer.alloc(4);class ye{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){const r=t.mask&&t.readOnly;let n=t.mask?6:2,i=e.length;e.length>=65536?(n+=8,i=127):e.length>125&&(n+=2,i=126);const o=Buffer.allocUnsafe(r?e.length+n:n);return o[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(o[0]|=64),o[1]=i,i===126?o.writeUInt16BE(e.length,2):i===127&&(o.writeUInt32BE(0,2),o.writeUInt32BE(e.length,6)),t.mask?(mn(be,0,4),o[1]|=128,o[n-4]=be[0],o[n-3]=be[1],o[n-2]=be[2],o[n-1]=be[3],r?(es(e,be,o,n,e.length),[o]):(es(e,be,e,0,e.length),[o,e])):[o,e]}close(e,t,r,n){let i;if(e===void 0)i=yn;else{if(typeof e!="number"||!gn(e))throw new TypeError("First argument must be a valid error code number");if(t===void 0||!t.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0);else{const o=Buffer.byteLength(t);if(o>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+o),i.writeUInt16BE(e,0),typeof t=="string"?i.write(t,2):i.set(t,2)}}this._deflating?this.enqueue([this.doClose,i,r,n]):this.doClose(i,r,n)}doClose(e,t,r){this.sendFrame(ye.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),r)}ping(e,t,r){const n=ce(e);if(n.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPing,n,t,ce.readOnly,r]):this.doPing(n,t,ce.readOnly,r)}doPing(e,t,r,n){this.sendFrame(ye.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:r}),n)}pong(e,t,r){const n=ce(e);if(n.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPong,n,t,ce.readOnly,r]):this.doPong(n,t,ce.readOnly,r)}doPong(e,t,r,n){this.sendFrame(ye.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:r}),n)}send(e,t,r){const n=ce(e),i=this._extensions[B.extensionName];let o=t.binary?2:1,a=t.compress;if(this._firstFragment?(this._firstFragment=!1,a&&i&&i.params[i._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(a=n.length>=i._threshold),this._compress=a):(a=!1,o=0),t.fin&&(this._firstFragment=!0),i){const h={fin:t.fin,rsv1:a,opcode:o,mask:t.mask,readOnly:ce.readOnly};this._deflating?this.enqueue([this.dispatch,n,this._compress,h,r]):this.dispatch(n,this._compress,h,r)}else this.sendFrame(ye.frame(n,{fin:t.fin,rsv1:!1,opcode:o,mask:t.mask,readOnly:ce.readOnly}),r)}dispatch(e,t,r,n){if(!t){this.sendFrame(ye.frame(e,r),n);return}const i=this._extensions[B.extensionName];this._bufferedBytes+=e.length,this._deflating=!0,i.compress(e,r.fin,(o,a)=>{if(this._socket.destroyed){const h=new Error("The socket was closed while data was being compressed");typeof n=="function"&&n(h);for(let c=0;c<this._queue.length;c++){const l=this._queue[c][4];typeof l=="function"&&l(h)}return}this._bufferedBytes-=e.length,this._deflating=!1,r.readOnly=!1,this.sendFrame(ye.frame(a,r),n),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[1].length,Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}var js=ye;const{kForOnEventAttribute:dt,kListener:ts}=we,ss=Symbol("kCode"),rs=Symbol("kData"),ns=Symbol("kError"),is=Symbol("kMessage"),os=Symbol("kReason"),Te=Symbol("kTarget"),as=Symbol("kType"),hs=Symbol("kWasClean");class Se{constructor(e){this[Te]=null,this[as]=e}get target(){return this[Te]}get type(){return this[as]}}Object.defineProperty(Se.prototype,"target",{enumerable:!0});Object.defineProperty(Se.prototype,"type",{enumerable:!0});class qe extends Se{constructor(e,t={}){super(e),this[ss]=t.code===void 0?0:t.code,this[os]=t.reason===void 0?"":t.reason,this[hs]=t.wasClean===void 0?!1:t.wasClean}get code(){return this[ss]}get reason(){return this[os]}get wasClean(){return this[hs]}}Object.defineProperty(qe.prototype,"code",{enumerable:!0});Object.defineProperty(qe.prototype,"reason",{enumerable:!0});Object.defineProperty(qe.prototype,"wasClean",{enumerable:!0});class it extends Se{constructor(e,t={}){super(e),this[ns]=t.error===void 0?null:t.error,this[is]=t.message===void 0?"":t.message}get error(){return this[ns]}get message(){return this[is]}}Object.defineProperty(it.prototype,"error",{enumerable:!0});Object.defineProperty(it.prototype,"message",{enumerable:!0});class Rt extends Se{constructor(e,t={}){super(e),this[rs]=t.data===void 0?null:t.data}get data(){return this[rs]}}Object.defineProperty(Rt.prototype,"data",{enumerable:!0});const _n={addEventListener(s,e,t={}){let r;if(s==="message")r=function(i,o){const a=new Rt("message",{data:o?i:i.toString()});a[Te]=this,e.call(this,a)};else if(s==="close")r=function(i,o){const a=new qe("close",{code:i,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[Te]=this,e.call(this,a)};else if(s==="error")r=function(i){const o=new it("error",{error:i,message:i.message});o[Te]=this,e.call(this,o)};else if(s==="open")r=function(){const i=new Se("open");i[Te]=this,e.call(this,i)};else return;r[dt]=!!t[dt],r[ts]=e,t.once?this.once(s,r):this.on(s,r)},removeEventListener(s,e){for(const t of this.listeners(s))if(t[ts]===e&&!t[dt]){this.removeListener(s,t);break}}};var vn={CloseEvent:qe,ErrorEvent:it,Event:Se,EventTarget:_n,MessageEvent:Rt};const{tokenChars:Be}=nt;function te(s,e,t){s[e]===void 0?s[e]=[t]:s[e].push(t)}function En(s){const e=Object.create(null);let t=Object.create(null),r=!1,n=!1,i=!1,o,a,h=-1,c=-1,l=-1,u=0;for(;u<s.length;u++)if(c=s.charCodeAt(u),o===void 0)if(l===-1&&Be[c]===1)h===-1&&(h=u);else if(u!==0&&(c===32||c===9))l===-1&&h!==-1&&(l=u);else if(c===59||c===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1&&(l=u);const p=s.slice(h,l);c===44?(te(e,p,t),t=Object.create(null)):o=p,h=l=-1}else throw new SyntaxError(`Unexpected character at index ${u}`);else if(a===void 0)if(l===-1&&Be[c]===1)h===-1&&(h=u);else if(c===32||c===9)l===-1&&h!==-1&&(l=u);else if(c===59||c===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1&&(l=u),te(t,s.slice(h,l),!0),c===44&&(te(e,o,t),t=Object.create(null),o=void 0),h=l=-1}else if(c===61&&h!==-1&&l===-1)a=s.slice(h,u),h=l=-1;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(n){if(Be[c]!==1)throw new SyntaxError(`Unexpected character at index ${u}`);h===-1?h=u:r||(r=!0),n=!1}else if(i)if(Be[c]===1)h===-1&&(h=u);else if(c===34&&h!==-1)i=!1,l=u;else if(c===92)n=!0;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(c===34&&s.charCodeAt(u-1)===61)i=!0;else if(l===-1&&Be[c]===1)h===-1&&(h=u);else if(h!==-1&&(c===32||c===9))l===-1&&(l=u);else if(c===59||c===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1&&(l=u);let p=s.slice(h,l);r&&(p=p.replace(/\\/g,""),r=!1),te(t,a,p),c===44&&(te(e,o,t),t=Object.create(null),o=void 0),a=void 0,h=l=-1}else throw new SyntaxError(`Unexpected character at index ${u}`);if(h===-1||i||c===32||c===9)throw new SyntaxError("Unexpected end of input");l===-1&&(l=u);const d=s.slice(h,l);return o===void 0?te(e,d,t):(a===void 0?te(t,d,!0):r?te(t,a,d.replace(/\\/g,"")):te(t,a,d),te(e,o,t)),e}function bn(s){return Object.keys(s).map(e=>{let t=s[e];return Array.isArray(t)||(t=[t]),t.map(r=>[e].concat(Object.keys(r).map(n=>{let i=r[n];return Array.isArray(i)||(i=[i]),i.map(o=>o===!0?n:`${n}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}var St={format:bn,parse:En};const{randomBytes:xn,createHash:wn}=T,{URL:pt}=ve,{BINARY_TYPES:cs,EMPTY_BUFFER:We,GUID:Sn,kForOnEventAttribute:mt,kListener:On,kStatusCode:Cn,kWebSocket:U,NOOP:qs}=we,{EventTarget:{addEventListener:Tn,removeEventListener:Nn}}=vn,{format:kn,parse:Ln}=St,{toBuffer:Rn}=$e,le=["CONNECTING","OPEN","CLOSING","CLOSED"],An=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,yt=[8,13],Pn=30*1e3;class b extends Ss{constructor(e,t,r){super(),this._binaryType=cs[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=We,this._closeTimer=null,this._extensions={},this._protocol="",this._readyState=b.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,t===void 0?t=[]:Array.isArray(t)||(typeof t=="object"&&t!==null?(r=t,t=[]):t=[t]),Vs(this,e,t,r)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(e){cs.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){const n=new $s({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation});this._sender=new js(e,this._extensions),this._receiver=n,this._socket=e,n[U]=this,e[U]=this,n.on("conclude",In),n.on("drain",Un),n.on("error",Mn),n.on("message",Fn),n.on("ping",$n),n.on("pong",jn),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",Hs),e.on("data",ot),e.on("end",Gs),e.on("error",zs),this._readyState=b.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=b.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[B.extensionName]&&this._extensions[B.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=b.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==b.CLOSED){if(this.readyState===b.CONNECTING){const r="WebSocket was closed before the connection was established";return G(this,this._req,r)}if(this.readyState===b.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=b.CLOSING,this._sender.close(e,t,!this._isServer,r=>{r||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),Pn)}}ping(e,t,r){if(this.readyState===b.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==b.OPEN){gt(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.ping(e||We,t,r)}pong(e,t,r){if(this.readyState===b.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==b.OPEN){gt(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.pong(e||We,t,r)}send(e,t,r){if(this.readyState===b.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"&&(r=t,t={}),typeof e=="number"&&(e=e.toString()),this.readyState!==b.OPEN){gt(this,e,r);return}const n={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[B.extensionName]||(n.compress=!1),this._sender.send(e||We,n,r)}terminate(){if(this.readyState!==b.CLOSED){if(this.readyState===b.CONNECTING){const e="WebSocket was closed before the connection was established";return G(this,this._req,e)}this._socket&&(this._readyState=b.CLOSING,this._socket.destroy())}}}Object.defineProperty(b,"CONNECTING",{enumerable:!0,value:le.indexOf("CONNECTING")});Object.defineProperty(b.prototype,"CONNECTING",{enumerable:!0,value:le.indexOf("CONNECTING")});Object.defineProperty(b,"OPEN",{enumerable:!0,value:le.indexOf("OPEN")});Object.defineProperty(b.prototype,"OPEN",{enumerable:!0,value:le.indexOf("OPEN")});Object.defineProperty(b,"CLOSING",{enumerable:!0,value:le.indexOf("CLOSING")});Object.defineProperty(b.prototype,"CLOSING",{enumerable:!0,value:le.indexOf("CLOSING")});Object.defineProperty(b,"CLOSED",{enumerable:!0,value:le.indexOf("CLOSED")});Object.defineProperty(b.prototype,"CLOSED",{enumerable:!0,value:le.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","protocol","readyState","url"].forEach(s=>{Object.defineProperty(b.prototype,s,{enumerable:!0})});["open","error","close","message"].forEach(s=>{Object.defineProperty(b.prototype,`on${s}`,{enumerable:!0,get(){for(const e of this.listeners(s))if(e[mt])return e[On];return null},set(e){for(const t of this.listeners(s))if(t[mt]){this.removeListener(s,t);break}typeof e=="function"&&this.addEventListener(s,e,{[mt]:!0})}})});b.prototype.addEventListener=Tn;b.prototype.removeEventListener=Nn;var ie=b;function Vs(s,e,t,r){const n={protocolVersion:yt[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...r,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,host:void 0,path:void 0,port:void 0};if(!yt.includes(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} (supported versions: ${yt.join(", ")})`);let i;if(e instanceof pt)i=e,s._url=e.href;else{try{i=new pt(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}s._url=e}const o=i.protocol==="wss:",a=i.protocol==="ws+unix:";if(i.protocol!=="ws:"&&!o&&!a)throw new SyntaxError(`The URL's protocol must be one of "ws:", "wss:", or "ws+unix:"`);if(a&&!i.pathname)throw new SyntaxError("The URL's pathname is empty");if(i.hash)throw new SyntaxError("The URL contains a fragment identifier");const h=o?443:80,c=xn(16).toString("base64"),l=T.get,u=new Set;let d;if(n.createConnection=o?Dn:Bn,n.defaultPort=n.defaultPort||h,n.port=i.port||h,n.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,n.headers={"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":c,Connection:"Upgrade",Upgrade:"websocket",...n.headers},n.path=i.pathname+i.search,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(d=new B(n.perMessageDeflate!==!0?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=kn({[B.extensionName]:d.offer()})),t.length){for(const v of t){if(typeof v!="string"||!An.test(v)||u.has(v))throw new SyntaxError("An invalid or duplicated subprotocol was specified");u.add(v)}n.headers["Sec-WebSocket-Protocol"]=t.join(",")}if(n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin),(i.username||i.password)&&(n.auth=`${i.username}:${i.password}`),a){const v=n.path.split(":");n.socketPath=v[0],n.path=v[1]}let p=s._req=l(n);n.timeout&&p.on("timeout",()=>{G(s,p,"Opening handshake has timed out")}),p.on("error",v=>{p===null||p.aborted||(p=s._req=null,s._readyState=b.CLOSING,s.emit("error",v),s.emitClose())}),p.on("response",v=>{const S=v.headers.location,L=v.statusCode;if(S&&n.followRedirects&&L>=300&&L<400){if(++s._redirects>n.maxRedirects){G(s,p,"Maximum redirects exceeded");return}p.abort();const q=new pt(S,e);Vs(s,q,t,r)}else s.emit("unexpected-response",p,v)||G(s,p,`Unexpected server response: ${v.statusCode}`)}),p.on("upgrade",(v,S,L)=>{if(s.emit("upgrade",v),s.readyState!==b.CONNECTING)return;p=s._req=null;const q=wn("sha1").update(c+Sn).digest("base64");if(v.headers["sec-websocket-accept"]!==q){G(s,S,"Invalid Sec-WebSocket-Accept header");return}const m=v.headers["sec-websocket-protocol"];let f;if(m!==void 0?u.size?u.has(m)||(f="Server sent an invalid subprotocol"):f="Server sent a subprotocol but none was requested":u.size&&(f="Server sent no subprotocol"),f){G(s,S,f);return}m&&(s._protocol=m);const _=v.headers["sec-websocket-extensions"];if(_!==void 0){if(!d){G(s,S,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let x;try{x=Ln(_)}catch{G(s,S,"Invalid Sec-WebSocket-Extensions header");return}const O=Object.keys(x);if(O.length!==1||O[0]!==B.extensionName){G(s,S,"Server indicated an extension that was not requested");return}try{d.accept(x[B.extensionName])}catch{G(s,S,"Invalid Sec-WebSocket-Extensions header");return}s._extensions[B.extensionName]=d}s.setSocket(S,L,{maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation})})}function Bn(s){return s.path=s.socketPath,T.connect(s)}function Dn(s){return s.path=void 0,!s.servername&&s.servername!==""&&(s.servername=T.isIP(s.host)?"":s.host),T.connect(s)}function G(s,e,t){s._readyState=b.CLOSING;const r=new Error(t);Error.captureStackTrace(r,G),e.setHeader?(e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),e.once("abort",s.emitClose.bind(s)),s.emit("error",r)):(e.destroy(r),e.once("error",s.emit.bind(s,"error")),e.once("close",s.emitClose.bind(s)))}function gt(s,e,t){if(e){const r=Rn(e).length;s._socket?s._sender._bufferedBytes+=r:s._bufferedAmount+=r}if(t){const r=new Error(`WebSocket is not open: readyState ${s.readyState} (${le[s.readyState]})`);t(r)}}function In(s,e){const t=this[U];t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=s,t._socket[U]!==void 0&&(t._socket.removeListener("data",ot),process.nextTick(Ws,t._socket),s===1005?t.close():t.close(s,e))}function Un(){this[U]._socket.resume()}function Mn(s){const e=this[U];e._socket[U]!==void 0&&(e._socket.removeListener("data",ot),process.nextTick(Ws,e._socket),e.close(s[Cn])),e.emit("error",s)}function fs(){this[U].emitClose()}function Fn(s,e){this[U].emit("message",s,e)}function $n(s){const e=this[U];e.pong(s,!e._isServer,qs),e.emit("ping",s)}function jn(s){this[U].emit("pong",s)}function Ws(s){s.resume()}function Hs(){const s=this[U];this.removeListener("close",Hs),this.removeListener("data",ot),this.removeListener("end",Gs),s._readyState=b.CLOSING;let e;!this._readableState.endEmitted&&!s._closeFrameReceived&&!s._receiver._writableState.errorEmitted&&(e=s._socket.read())!==null&&s._receiver.write(e),s._receiver.end(),this[U]=void 0,clearTimeout(s._closeTimer),s._receiver._writableState.finished||s._receiver._writableState.errorEmitted?s.emitClose():(s._receiver.on("error",fs),s._receiver.on("finish",fs))}function ot(s){this[U]._receiver.write(s)||this.pause()}function Gs(){const s=this[U];s._readyState=b.CLOSING,s._receiver.end(),this.end()}function zs(){const s=this[U];this.removeListener("error",zs),this.on("error",qs),s&&(s._readyState=b.CLOSING,this.destroy())}const{Duplex:qn}=T;function ls(s){s.emit("close")}function Vn(){!this.destroyed&&this._writableState.finished&&this.destroy()}function Ys(s){this.removeListener("error",Ys),this.destroy(),this.listenerCount("error")===0&&this.emit("error",s)}function Wn(s,e){let t=!0,r=!0;function n(){t&&s._socket.resume()}s.readyState===s.CONNECTING?s.once("open",function(){s._receiver.removeAllListeners("drain"),s._receiver.on("drain",n)}):(s._receiver.removeAllListeners("drain"),s._receiver.on("drain",n));const i=new qn({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return s.on("message",function(a,h){const c=!h&&i._readableState.objectMode?a.toString():a;i.push(c)||(t=!1,s._socket.pause())}),s.once("error",function(a){i.destroyed||(r=!1,i.destroy(a))}),s.once("close",function(){i.destroyed||i.push(null)}),i._destroy=function(o,a){if(s.readyState===s.CLOSED){a(o),process.nextTick(ls,i);return}let h=!1;s.once("error",function(l){h=!0,a(l)}),s.once("close",function(){h||a(o),process.nextTick(ls,i)}),r&&s.terminate()},i._final=function(o){if(s.readyState===s.CONNECTING){s.once("open",function(){i._final(o)});return}s._socket!==null&&(s._socket._writableState.finished?(o(),i._readableState.endEmitted&&i.destroy()):(s._socket.once("finish",function(){o()}),s.close()))},i._read=function(){s.readyState===s.OPEN&&!t&&(t=!0,s._receiver._writableState.needDrain||s._socket.resume())},i._write=function(o,a,h){if(s.readyState===s.CONNECTING){s.once("open",function(){i._write(o,a,h)});return}s.send(o,h)},i.on("end",Vn),i.on("error",Ys),i}var Hn=Wn;const{tokenChars:Gn}=nt;function zn(s){const e=new Set;let t=-1,r=-1,n=0;for(n;n<s.length;n++){const o=s.charCodeAt(n);if(r===-1&&Gn[o]===1)t===-1&&(t=n);else if(n!==0&&(o===32||o===9))r===-1&&t!==-1&&(r=n);else if(o===44){if(t===-1)throw new SyntaxError(`Unexpected character at index ${n}`);r===-1&&(r=n);const a=s.slice(t,r);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),t=r=-1}else throw new SyntaxError(`Unexpected character at index ${n}`)}if(t===-1||r!==-1)throw new SyntaxError("Unexpected end of input");const i=s.slice(t,n);if(e.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return e.add(i),e}var Yn={parse:zn};const{createHash:Kn}=T,{GUID:Xn,kWebSocket:Jn}=we,Qn=/^[+/0-9A-Za-z]{22}==$/,us=0,ds=1,Ks=2;class Zn extends Ss{constructor(e,t){if(super(),e={maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=T.createServer((r,n)=>{const i=T.STATUS_CODES[426];n.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),n.end(i)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const r=this.emit.bind(this,"connection");this._removeListeners=ti(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(n,i,o)=>{this.handleUpgrade(n,i,o,r)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=us}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===Ks){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(De,this);return}if(e&&this.once("close",e),this._state!==ds)if(this._state=ds,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(De,this):process.nextTick(De,this);else{const t=this._server;this._removeListeners(),this._removeListeners=this._server=null,t.close(()=>{De(this)})}}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,n){t.on("error",Ot);const i=e.headers["sec-websocket-key"]!==void 0?e.headers["sec-websocket-key"]:!1,o=+e.headers["sec-websocket-version"];if(e.method!=="GET"||e.headers.upgrade.toLowerCase()!=="websocket"||!i||!Qn.test(i)||o!==8&&o!==13||!this.shouldHandle(e))return Oe(t,400);const a=e.headers["sec-websocket-protocol"];let h=new Set;if(a!==void 0)try{h=Yn.parse(a)}catch{return Oe(t,400)}const c=e.headers["sec-websocket-extensions"],l={};if(this.options.perMessageDeflate&&c!==void 0){const u=new B(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const d=St.parse(c);d[B.extensionName]&&(u.accept(d[B.extensionName]),l[B.extensionName]=u)}catch{return Oe(t,400)}}if(this.options.verifyClient){const u={origin:e.headers[`${o===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(u,(d,p,v,S)=>{if(!d)return Oe(t,p||401,v,S);this.completeUpgrade(l,i,h,e,t,r,n)});return}if(!this.options.verifyClient(u))return Oe(t,401)}this.completeUpgrade(l,i,h,e,t,r,n)}completeUpgrade(e,t,r,n,i,o,a){if(!i.readable||!i.writable)return i.destroy();if(i[Jn])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>us)return Oe(i,503);const c=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Kn("sha1").update(t+Xn).digest("base64")}`],l=new ie(null);if(r.size){const u=this.options.handleProtocols?this.options.handleProtocols(r,n):r.values().next().value;u&&(c.push(`Sec-WebSocket-Protocol: ${u}`),l._protocol=u)}if(e[B.extensionName]){const u=e[B.extensionName].params,d=St.format({[B.extensionName]:[u]});c.push(`Sec-WebSocket-Extensions: ${d}`),l._extensions=e}this.emit("headers",c,n),i.write(c.concat(`\r
`).join(`\r
`)),i.removeListener("error",Ot),l.setSocket(i,o,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(l),l.on("close",()=>{this.clients.delete(l),this._shouldEmitClose&&!this.clients.size&&process.nextTick(De,this)})),a(l,n)}}var ei=Zn;function ti(s,e){for(const t of Object.keys(e))s.on(t,e[t]);return function(){for(const r of Object.keys(e))s.removeListener(r,e[r])}}function De(s){s._state=Ks,s.emit("close")}function Ot(){this.destroy()}function Oe(s,e,t,r){s.writable&&(t=t||T.STATUS_CODES[e],r={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(t),...r},s.write(`HTTP/1.1 ${e} ${T.STATUS_CODES[e]}\r
`+Object.keys(r).map(n=>`${n}: ${r[n]}`).join(`\r
`)+`\r
\r
`+t)),s.removeListener("error",Ot),s.destroy()}ie.createWebSocketStream=Hn;ie.Server=ei;ie.Receiver=$s;ie.Sender=js;ie.WebSocket=ie;ie.WebSocketServer=ie.Server;var si=ie;const Ie=si,ps=!1,ri="nodebuffer",ni=process.nextTick,ms=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class At extends Ps{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=ms?{}:Ns(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=ps&&!ms?t?new Ie(e,t):new Ie(e):new Ie(e,t,r)}catch(n){return this.emit("error",n)}this.ws.binaryType=this.socket.binaryType||ri,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;ks(r,this.supportsBinary,i=>{const o={};r.options&&(o.compress=r.options.compress),this.opts.perMessageDeflate&&(typeof i=="string"?Buffer.byteLength(i):i.length)<this.opts.perMessageDeflate.threshold&&(o.compress=!1);try{ps||this.ws.send(i,o)}catch{}n&&ni(()=>{this.writable=!0,this.emit("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Is()),this.supportsBinary||(e.b64=1);const n=Lt.encode(e),i=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(i?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}check(){return!!Ie&&!("__initialize"in Ie&&this.name===At.prototype.name)}}const ii={websocket:At,polling:Jr};class ge extends Le{constructor(e,t={}){super(),e&&typeof e=="object"&&(t=e,e=null),e?(e=bt(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=bt(t.host).host),rt(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+"/",typeof this.opts.query=="string"&&(this.opts.query=Lt.decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close")},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=oi(this.opts.query);t.EIO=As,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new ii[e](r)}open(){let e;if(this.opts.rememberUpgrade&&ge.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",()=>{this.onClose("transport close")})}probe(e){let t=this.createTransport(e),r=!1;ge.priorWebsocketSuccess=!1;const n=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",u=>{if(!r)if(u.type==="pong"&&u.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;ge.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const d=new Error("probe error");d.transport=t.name,this.emitReserved("upgradeError",d)}}))};function i(){r||(r=!0,l(),t.close(),t=null)}const o=u=>{const d=new Error("probe error: "+u);d.transport=t.name,i(),this.emitReserved("upgradeError",d)};function a(){o("transport closed")}function h(){o("socket closed")}function c(u){t&&u.name!==t.name&&i()}const l=()=>{t.removeListener("open",n),t.removeListener("error",o),t.removeListener("close",a),this.off("close",h),this.off("upgrading",c)};t.once("open",n),t.once("error",o),t.once("close",a),this.once("close",h),this.once("upgrading",c),t.open()}onOpen(){if(this.readyState="open",ge.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade&&this.transport.pause){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,n){if(typeof t=="function"&&(n=t,t=void 0),typeof r=="function"&&(n=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const i={type:e,data:t,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){ge.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const n=e.length;for(;r<n;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}ge.protocol=As;function oi(s){const e={};for(let t in s)s.hasOwnProperty(t)&&(e[t]=s[t]);return e}const ai=typeof ArrayBuffer=="function",hi=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s.buffer instanceof ArrayBuffer,Xs=Object.prototype.toString,ci=typeof Blob=="function"||typeof Blob<"u"&&Xs.call(Blob)==="[object BlobConstructor]",fi=typeof File=="function"||typeof File<"u"&&Xs.call(File)==="[object FileConstructor]";function Pt(s){return ai&&(s instanceof ArrayBuffer||hi(s))||ci&&s instanceof Blob||fi&&s instanceof File}function Je(s,e){if(!s||typeof s!="object")return!1;if(Array.isArray(s)){for(let t=0,r=s.length;t<r;t++)if(Je(s[t]))return!0;return!1}if(Pt(s))return!0;if(s.toJSON&&typeof s.toJSON=="function"&&arguments.length===1)return Je(s.toJSON(),!0);for(const t in s)if(Object.prototype.hasOwnProperty.call(s,t)&&Je(s[t]))return!0;return!1}function li(s){const e=[],t=s.data,r=s;return r.data=Ct(t,e),r.attachments=e.length,{packet:r,buffers:e}}function Ct(s,e){if(!s)return s;if(Pt(s)){const t={_placeholder:!0,num:e.length};return e.push(s),t}else if(Array.isArray(s)){const t=new Array(s.length);for(let r=0;r<s.length;r++)t[r]=Ct(s[r],e);return t}else if(typeof s=="object"&&!(s instanceof Date)){const t={};for(const r in s)s.hasOwnProperty(r)&&(t[r]=Ct(s[r],e));return t}return s}function ui(s,e){return s.data=Tt(s.data,e),s.attachments=void 0,s}function Tt(s,e){if(!s)return s;if(s&&s._placeholder)return e[s.num];if(Array.isArray(s))for(let t=0;t<s.length;t++)s[t]=Tt(s[t],e);else if(typeof s=="object")for(const t in s)s.hasOwnProperty(t)&&(s[t]=Tt(s[t],e));return s}const Js=5;var w;(function(s){s[s.CONNECT=0]="CONNECT",s[s.DISCONNECT=1]="DISCONNECT",s[s.EVENT=2]="EVENT",s[s.ACK=3]="ACK",s[s.CONNECT_ERROR=4]="CONNECT_ERROR",s[s.BINARY_EVENT=5]="BINARY_EVENT",s[s.BINARY_ACK=6]="BINARY_ACK"})(w||(w={}));class di{encode(e){return(e.type===w.EVENT||e.type===w.ACK)&&Je(e)?(e.type=e.type===w.EVENT?w.BINARY_EVENT:w.BINARY_ACK,this.encodeAsBinary(e)):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===w.BINARY_EVENT||e.type===w.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data)),t}encodeAsBinary(e){const t=li(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}}class Bt extends Le{constructor(){super()}add(e){let t;if(typeof e=="string")t=this.decodeString(e),t.type===w.BINARY_EVENT||t.type===w.BINARY_ACK?(this.reconstructor=new mi(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t);else if(Pt(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(w[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===w.BINARY_EVENT||r.type===w.BINARY_ACK){const i=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(i,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(t+1)==="/"){const i=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(i,t)}else r.nsp="/";const n=e.charAt(t+1);if(n!==""&&Number(n)==n){const i=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}r.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=pi(e.substr(t));if(Bt.isPayloadValid(r.type,i))r.data=i;else throw new Error("invalid payload")}return r}static isPayloadValid(e,t){switch(e){case w.CONNECT:return typeof t=="object";case w.DISCONNECT:return t===void 0;case w.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case w.EVENT:case w.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case w.ACK:case w.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}function pi(s){try{return JSON.parse(s)}catch{return!1}}class mi{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=ui(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}var yi=Object.freeze({__proto__:null,protocol:Js,get PacketType(){return w},Encoder:di,Decoder:Bt});function J(s,e,t){return s.on(e,t),function(){s.off(e,t)}}const gi=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Dt extends Le{constructor(e,t,r){super(),this.connected=!1,this.disconnected=!0,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this.io._autoConnect&&this.open()}subEvents(){if(this.subs)return;const e=this.io;this.subs=[J(e,"open",this.onopen.bind(this)),J(e,"packet",this.onpacket.bind(this)),J(e,"error",this.onerror.bind(this)),J(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(gi.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');t.unshift(e);const r={type:w.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,a=t.pop();this._registerAckCallback(o,a),r.id=o}const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!n||!this.connected)||(this.connected?this.packet(r):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){const r=this.flags.timeout;if(r===void 0){this.acks[e]=t;return}const n=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let i=0;i<this.sendBuffer.length;i++)this.sendBuffer[i].id===e&&this.sendBuffer.splice(i,1);t.call(this,new Error("operation has timed out"))},r);this.acks[e]=(...i)=>{this.io.clearTimeoutFn(n),t.apply(this,[null,...i])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this.packet({type:w.CONNECT,data:e})}):this.packet({type:w.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e){this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",e)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case w.CONNECT:if(e.data&&e.data.sid){const n=e.data.sid;this.onconnect(n)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case w.EVENT:this.onevent(e);break;case w.BINARY_EVENT:this.onevent(e);break;case w.ACK:this.onack(e);break;case w.BINARY_ACK:this.onack(e);break;case w.DISCONNECT:this.ondisconnect();break;case w.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let r=!1;return function(...n){r||(r=!0,t.packet({type:w.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>this.packet(e)),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:w.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}var _i=Re;function Re(s){s=s||{},this.ms=s.min||100,this.max=s.max||1e4,this.factor=s.factor||2,this.jitter=s.jitter>0&&s.jitter<=1?s.jitter:0,this.attempts=0}Re.prototype.duration=function(){var s=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*s);s=Math.floor(e*10)&1?s+t:s-t}return Math.min(s,this.max)|0};Re.prototype.reset=function(){this.attempts=0};Re.prototype.setMin=function(s){this.ms=s};Re.prototype.setMax=function(s){this.max=s};Re.prototype.setJitter=function(s){this.jitter=s};class tt extends Le{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,rt(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new _i({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const n=t.parser||yi;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ge(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=J(t,"open",function(){r.onopen(),e&&e()}),i=J(t,"error",o=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",o),e?e(o):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const o=this._timeout;o===0&&n();const a=this.setTimeoutFn(()=>{n(),t.close(),t.emit("error",new Error("timeout"))},o);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(n),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(J(e,"ping",this.onping.bind(this)),J(e,"data",this.ondata.bind(this)),J(e,"error",this.onerror.bind(this)),J(e,"close",this.onclose.bind(this)),J(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){this.decoder.add(e)}ondecoded(e){this.emitReserved("packet",e)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r||(r=new Dt(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(n=>{n?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",n)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Ue={};function xe(s,e){typeof s=="object"&&(e=s,s=void 0),e=e||{};const t=Pr(s,e.path||"/socket.io"),r=t.source,n=t.id,i=t.path,o=Ue[n]&&i in Ue[n].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let h;return a?h=new tt(r,e):(Ue[n]||(Ue[n]=new tt(r,e)),h=Ue[n]),t.query&&!e.query&&(e.query=t.queryKey),h.socket(t.path,e)}Object.assign(xe,{Manager:tt,Socket:Dt,io:xe,connect:xe});var vi=Object.freeze({__proto__:null,Manager:tt,Socket:Dt,io:xe,connect:xe,default:xe,protocol:Js});const Ei=require("simple-signal-client");var It=Os({name:"vue-webrtc",components:{},data(){return{signalClient:null,videoList:[],canvas:null,socket:null}},props:{roomId:{type:String,default:"public-room-v2"},socketURL:{type:String,default:"https://weston-vue-webrtc-lobby.azurewebsites.net"},cameraHeight:{type:[Number,String],default:160},autoplay:{type:Boolean,default:!0},screenshotFormat:{type:String,default:"image/jpeg"},enableAudio:{type:Boolean,default:!0},enableVideo:{type:Boolean,default:!0},enableLogs:{type:Boolean,default:!1},peerOptions:{type:Object,default(){return{}}},ioOptions:{type:Object,default(){return{rejectUnauthorized:!1,transports:["polling","websocket"]}}},deviceId:{type:String,default:null}},watch:{},mounted(){},methods:{async join(){var s=this;this.log("join"),this.socket=xe(this.socketURL,this.ioOptions),this.signalClient=new Ei(this.socket);let e={video:s.enableVideo,audio:s.enableAudio};s.deviceId&&s.enableVideo&&(e.video={deviceId:{exact:s.deviceId}});const t=await navigator.mediaDevices.getUserMedia(e);this.log("opened",t),this.joinedRoom(t,!0),this.signalClient.once("discover",r=>{s.log("discovered",r);async function n(i){if(i!=s.socket.id)try{s.log("Connecting to peer");const{peer:o}=await s.signalClient.connect(i,s.roomId,s.peerOptions);s.videoList.forEach(a=>{a.isLocal&&s.onPeer(o,a.stream)})}catch{s.log("Error connecting to peer")}}r.peers.forEach(i=>n(i)),s.$emit("opened-room",s.roomId)}),this.signalClient.on("request",async r=>{s.log("requested",r);const{peer:n}=await r.accept({},s.peerOptions);s.log("accepted",n),s.videoList.forEach(i=>{i.isLocal&&s.onPeer(n,i.stream)})}),this.signalClient.discover(s.roomId)},onPeer(s,e){var t=this;t.log("onPeer"),s.addStream(e),s.on("stream",r=>{t.joinedRoom(r,!1),s.on("close",()=>{var n=[];t.videoList.forEach(function(i){i.id!==r.id&&n.push(i)}),t.videoList=n,t.$emit("left-room",r.id)}),s.on("error",n=>{t.log("peer error ",n)})})},joinedRoom(s,e){var t=this;if(t.videoList.find(n=>n.id===s.id)===void 0){let n={id:s.id,muted:e,stream:s,isLocal:e};t.videoList.push(n)}setTimeout(function(){for(var n=0,i=t.$refs.videos.length;n<i;n++)if(t.$refs.videos[n].id===s.id){t.$refs.videos[n].srcObject=s;break}},500),t.$emit("joined-room",s.id)},leave(){this.videoList.forEach(s=>s.stream.getTracks().forEach(e=>e.stop())),this.videoList=[],this.signalClient.peers().forEach(s=>s.removeAllListeners()),this.signalClient.destroy(),this.signalClient=null,this.socket.destroy(),this.socket=null},capture(){return this.getCanvas().toDataURL(this.screenshotFormat)},getCanvas(){let s=this.$refs.videos[0];if(s!==null&&!this.ctx){let r=document.createElement("canvas");r.height=s.clientHeight,r.width=s.clientWidth,this.canvas=r,this.ctx=r.getContext("2d")}const{ctx:e,canvas:t}=this;return e.drawImage(s,0,0,t.width,t.height),t},async shareScreen(){var s=this;if(navigator.mediaDevices==null){s.log("Error: https is required to load cameras");return}try{var e=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1});this.joinedRoom(e,!0),s.$emit("share-started",e.id),s.signalClient.peers().forEach(t=>s.onPeer(t,e))}catch(t){s.log("Media error: "+JSON.stringify(t))}},log(s,e){this.enableLogs&&(console.log(s),e!=null&&console.log(e))}}});const bi={class:"video-list"},xi=["video"],wi=["height","muted","id"];function Si(s,e,t,r,n,i){return Ge(),ze("div",bi,[(Ge(!0),ze(Cr,null,Tr(s.videoList,o=>(Ge(),ze("div",{video:o,key:o.id,class:"video-item"},[pe("video",{controls:"",autoplay:"",playsinline:"",ref_for:!0,ref:"videos",height:s.cameraHeight,muted:o.muted,id:o.id},null,8,wi)],8,xi))),128))])}function Qs(s,e){e===void 0&&(e={});var t=e.insertAt;if(!(!s||typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=s:n.appendChild(document.createTextNode(s))}}var Oi=`
.video-list[data-v-41044b41] {\r
        background: whitesmoke;\r
        height: auto;\r
        display: flex;\r
        flex-direction: row;\r
        justify-content: center;\r
        flex-wrap: wrap;
}
.video-list div[data-v-41044b41] {\r
            padding: 0px;
}
.video-item[data-v-41044b41] {\r
        background: #c5c4c4;\r
        display: inline-block;
}\r
`;Qs(Oi);It.render=Si;It.__scopeId="data-v-41044b41";var Ut=Os({name:"VueWebrtcSample",data(){return{counter:5,initCounter:5,message:{action:null,amount:null}}},computed:{changedBy(){const{message:s}=this;return s.action?`${s.action} ${s.amount||""}`.trim():"initialized"}},methods:{increment(s){const e=typeof s!="number"?1:s;this.counter+=e,this.message.action="incremented by",this.message.amount=e},decrement(s){const e=typeof s!="number"?1:s;this.counter-=e,this.message.action="decremented by",this.message.amount=e},reset(){this.counter=this.initCounter,this.message.action="reset",this.message.amount=null}}});const Ci={class:"vue-webrtc-sample"},Ti=Cs(".");function Ni(s,e,t,r,n,i){return Ge(),ze("div",Ci,[pe("p",null,[Cs("The counter was "+Vt(s.changedBy)+" to ",1),pe("b",null,Vt(s.counter),1),Ti]),pe("button",{onClick:e[0]||(e[0]=function(){return s.increment&&s.increment(...arguments)})}," Click +1 "),pe("button",{onClick:e[1]||(e[1]=function(){return s.decrement&&s.decrement(...arguments)})}," Click -1 "),pe("button",{onClick:e[2]||(e[2]=o=>s.increment(5))}," Click +5 "),pe("button",{onClick:e[3]||(e[3]=o=>s.decrement(5))}," Click -5 "),pe("button",{onClick:e[4]||(e[4]=function(){return s.reset&&s.reset(...arguments)})}," Reset ")])}var ki=`
.vue-webrtc-sample[data-v-3020e3b4] {\r
    display: block;\r
    width: 400px;\r
    margin: 25px auto;\r
    border: 1px solid #ccc;\r
    background: #eaeaea;\r
    text-align: center;\r
    padding: 25px;
}
.vue-webrtc-sample p[data-v-3020e3b4] {\r
    margin: 0 0 1em;
}\r
`;Qs(ki);Ut.render=Ni;Ut.__scopeId="data-v-3020e3b4";window.io=vi;var Li=Object.freeze({__proto__:null,VueWebRTC:It,VueWebrtcSample:Ut});const Ai=function(e){Object.entries(Li).forEach(t=>{let[r,n]=t;e.component(r,n)})};export{It as VueWebRTC,Ut as VueWebrtcSample,Ai as default};
