var Q={},P={},E={};Object.defineProperty(E,"__esModule",{value:!0});E.ERROR_PACKET=E.PACKET_TYPES_REVERSE=E.PACKET_TYPES=void 0;const A=Object.create(null);E.PACKET_TYPES=A;A.open="0";A.close="1";A.ping="2";A.pong="3";A.message="4";A.upgrade="5";A.noop="6";const M=Object.create(null);E.PACKET_TYPES_REVERSE=M;Object.keys(A).forEach(e=>{M[A[e]]=e});const W={type:"error",data:"parser error"};E.ERROR_PACKET=W;Object.defineProperty(P,"__esModule",{value:!0});P.encodePacket=P.encodePacketToBinary=void 0;const Z=E,F=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",J=typeof ArrayBuffer=="function",q=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,X=({type:e,data:r},t,n)=>F&&r instanceof Blob?t?n(r):U(r,n):J&&(r instanceof ArrayBuffer||q(r))?t?n(r):U(new Blob([r]),n):n(Z.PACKET_TYPES[e]+(r||""));P.encodePacket=X;const U=(e,r)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];r("b"+(n||""))},t.readAsDataURL(e)};function L(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let S;function z(e,r){if(F&&e.data instanceof Blob)return e.data.arrayBuffer().then(L).then(r);if(J&&(e.data instanceof ArrayBuffer||q(e.data)))return r(L(e.data));X(e,!1,t=>{S||(S=new TextEncoder),r(S.encode(t))})}P.encodePacketToBinary=z;var T={},R={};Object.defineProperty(R,"__esModule",{value:!0});R.decode=R.encode=void 0;const b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",N=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<b.length;e++)N[b.charCodeAt(e)]=e;const j=e=>{let r=new Uint8Array(e),t,n=r.length,o="";for(t=0;t<n;t+=3)o+=b[r[t]>>2],o+=b[(r[t]&3)<<4|r[t+1]>>4],o+=b[(r[t+1]&15)<<2|r[t+2]>>6],o+=b[r[t+2]&63];return n%3===2?o=o.substring(0,o.length-1)+"=":n%3===1&&(o=o.substring(0,o.length-2)+"=="),o};R.encode=j;const ee=e=>{let r=e.length*.75,t=e.length,n,o=0,d,l,m,w;e[e.length-1]==="="&&(r--,e[e.length-2]==="="&&r--);const _=new ArrayBuffer(r),g=new Uint8Array(_);for(n=0;n<t;n+=4)d=N[e.charCodeAt(n)],l=N[e.charCodeAt(n+1)],m=N[e.charCodeAt(n+2)],w=N[e.charCodeAt(n+3)],g[o++]=d<<2|l>>4,g[o++]=(l&15)<<4|m>>2,g[o++]=(m&3)<<6|w&63;return _};R.decode=ee;Object.defineProperty(T,"__esModule",{value:!0});T.decodePacket=void 0;const C=E,te=R,re=typeof ArrayBuffer=="function",ne=(e,r)=>{if(typeof e!="string")return{type:"message",data:x(e,r)};const t=e.charAt(0);return t==="b"?{type:"message",data:oe(e.substring(1),r)}:C.PACKET_TYPES_REVERSE[t]?e.length>1?{type:C.PACKET_TYPES_REVERSE[t],data:e.substring(1)}:{type:C.PACKET_TYPES_REVERSE[t]}:C.ERROR_PACKET};T.decodePacket=ne;const oe=(e,r)=>{if(re){const t=(0,te.decode)(e);return x(t,r)}else return{base64:!0,data:e}},x=(e,r)=>{switch(r){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.decodePayload=e.decodePacket=e.encodePayload=e.encodePacket=e.protocol=e.createPacketDecoderStream=e.createPacketEncoderStream=void 0;const r=P;Object.defineProperty(e,"encodePacket",{enumerable:!0,get:function(){return r.encodePacket}});const t=T;Object.defineProperty(e,"decodePacket",{enumerable:!0,get:function(){return t.decodePacket}});const n=E,o=String.fromCharCode(30),d=(a,h)=>{const f=a.length,i=new Array(f);let c=0;a.forEach((y,k)=>{(0,r.encodePacket)(y,!1,B=>{i[k]=B,++c===f&&h(i.join(o))})})};e.encodePayload=d;const l=(a,h)=>{const f=a.split(o),i=[];for(let c=0;c<f.length;c++){const y=(0,t.decodePacket)(f[c],h);if(i.push(y),y.type==="error")break}return i};e.decodePayload=l;function m(){return new TransformStream({transform(a,h){(0,r.encodePacketToBinary)(a,f=>{const i=f.length;let c;if(i<126)c=new Uint8Array(1),new DataView(c.buffer).setUint8(0,i);else if(i<65536){c=new Uint8Array(3);const y=new DataView(c.buffer);y.setUint8(0,126),y.setUint16(1,i)}else{c=new Uint8Array(9);const y=new DataView(c.buffer);y.setUint8(0,127),y.setBigUint64(1,BigInt(i))}a.data&&typeof a.data!="string"&&(c[0]|=128),h.enqueue(c),h.enqueue(f)})}})}e.createPacketEncoderStream=m;let w;function _(a){return a.reduce((h,f)=>h+f.length,0)}function g(a,h){if(a[0].length===h)return a.shift();const f=new Uint8Array(h);let i=0;for(let c=0;c<h;c++)f[c]=a[0][i++],i===a[0].length&&(a.shift(),i=0);return a.length&&i<a[0].length&&(a[0]=a[0].slice(i)),f}function H(a,h){w||(w=new TextDecoder);const f=[];let i=0,c=-1,y=!1;return new TransformStream({transform(k,B){for(f.push(k);;){if(i===0){if(_(f)<1)break;const p=g(f,1);y=(p[0]&128)===128,c=p[0]&127,c<126?i=3:c===126?i=1:i=2}else if(i===1){if(_(f)<2)break;const p=g(f,2);c=new DataView(p.buffer,p.byteOffset,p.length).getUint16(0),i=3}else if(i===2){if(_(f)<8)break;const p=g(f,8),D=new DataView(p.buffer,p.byteOffset,p.length),I=D.getUint32(0);if(I>Math.pow(2,53-32)-1){B.enqueue(n.ERROR_PACKET);break}c=I*Math.pow(2,32)+D.getUint32(4),i=3}else{if(_(f)<c)break;const p=g(f,c);B.enqueue((0,t.decodePacket)(y?p:w.decode(p),h)),i=0}if(c===0||c>a){B.enqueue(n.ERROR_PACKET);break}}}})}e.createPacketDecoderStream=H,e.protocol=4})(Q);function u(e){if(e)return ce(e)}function ce(e){for(var r in u.prototype)e[r]=u.prototype[r];return e}u.prototype.on=u.prototype.addEventListener=function(e,r){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(r),this};u.prototype.once=function(e,r){function t(){this.off(e,t),r.apply(this,arguments)}return t.fn=r,this.on(e,t),this};u.prototype.off=u.prototype.removeListener=u.prototype.removeAllListeners=u.prototype.removeEventListener=function(e,r){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+e];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var n,o=0;o<t.length;o++)if(n=t[o],n===r||n.fn===r){t.splice(o,1);break}return t.length===0&&delete this._callbacks["$"+e],this};u.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var r=new Array(arguments.length-1),t=this._callbacks["$"+e],n=1;n<arguments.length;n++)r[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,o=t.length;n<o;++n)t[n].apply(this,r)}return this};u.prototype.emitReserved=u.prototype.emit;u.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};u.prototype.hasListeners=function(e){return!!this.listeners(e).length};const ie=typeof ArrayBuffer=="function",se=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,G=Object.prototype.toString,fe=typeof Blob=="function"||typeof Blob<"u"&&G.call(Blob)==="[object BlobConstructor]",ae=typeof File=="function"||typeof File<"u"&&G.call(File)==="[object FileConstructor]";function K(e){return ie&&(e instanceof ArrayBuffer||se(e))||fe&&e instanceof Blob||ae&&e instanceof File}function O(e,r){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(O(e[t]))return!0;return!1}if(K(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return O(e.toJSON(),!0);for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&O(e[t]))return!0;return!1}function ue(e){const r=[],t=e.data,n=e;return n.data=v(t,r),n.attachments=r.length,{packet:n,buffers:r}}function v(e,r){if(!e)return e;if(K(e)){const t={_placeholder:!0,num:r.length};return r.push(e),t}else if(Array.isArray(e)){const t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=v(e[n],r);return t}else if(typeof e=="object"&&!(e instanceof Date)){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=v(e[n],r));return t}return e}function le(e,r){return e.data=V(e.data,r),delete e.attachments,e}function V(e,r){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<r.length)return r[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let t=0;t<e.length;t++)e[t]=V(e[t],r);else if(typeof e=="object")for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=V(e[t],r));return e}const he=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],de=5;var s;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(s||(s={}));class ye{constructor(r){this.replacer=r}encode(r){return(r.type===s.EVENT||r.type===s.ACK)&&O(r)?this.encodeAsBinary({type:r.type===s.EVENT?s.BINARY_EVENT:s.BINARY_ACK,nsp:r.nsp,data:r.data,id:r.id}):[this.encodeAsString(r)]}encodeAsString(r){let t=""+r.type;return(r.type===s.BINARY_EVENT||r.type===s.BINARY_ACK)&&(t+=r.attachments+"-"),r.nsp&&r.nsp!=="/"&&(t+=r.nsp+","),r.id!=null&&(t+=r.id),r.data!=null&&(t+=JSON.stringify(r.data,this.replacer)),t}encodeAsBinary(r){const t=ue(r),n=this.encodeAsString(t.packet),o=t.buffers;return o.unshift(n),o}}function $(e){return Object.prototype.toString.call(e)==="[object Object]"}class Y extends u{constructor(r){super(),this.reviver=r}add(r){let t;if(typeof r=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(r);const n=t.type===s.BINARY_EVENT;n||t.type===s.BINARY_ACK?(t.type=n?s.EVENT:s.ACK,this.reconstructor=new pe(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(K(r)||r.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(r),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+r)}decodeString(r){let t=0;const n={type:Number(r.charAt(0))};if(s[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===s.BINARY_EVENT||n.type===s.BINARY_ACK){const d=t+1;for(;r.charAt(++t)!=="-"&&t!=r.length;);const l=r.substring(d,t);if(l!=Number(l)||r.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(l)}if(r.charAt(t+1)==="/"){const d=t+1;for(;++t&&!(r.charAt(t)===","||t===r.length););n.nsp=r.substring(d,t)}else n.nsp="/";const o=r.charAt(t+1);if(o!==""&&Number(o)==o){const d=t+1;for(;++t;){const l=r.charAt(t);if(l==null||Number(l)!=l){--t;break}if(t===r.length)break}n.id=Number(r.substring(d,t+1))}if(r.charAt(++t)){const d=this.tryParse(r.substr(t));if(Y.isPayloadValid(n.type,d))n.data=d;else throw new Error("invalid payload")}return n}tryParse(r){try{return JSON.parse(r,this.reviver)}catch{return!1}}static isPayloadValid(r,t){switch(r){case s.CONNECT:return $(t);case s.DISCONNECT:return t===void 0;case s.CONNECT_ERROR:return typeof t=="string"||$(t);case s.EVENT:case s.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&he.indexOf(t[0])===-1);case s.ACK:case s.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class pe{constructor(r){this.packet=r,this.buffers=[],this.reconPack=r}takeBinaryData(r){if(this.buffers.push(r),this.buffers.length===this.reconPack.attachments){const t=le(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Ee=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Y,Encoder:ye,get PacketType(){return s},protocol:de},Symbol.toStringTag,{value:"Module"}));export{u as E,s as P,de as a,Q as c,Ee as p};
