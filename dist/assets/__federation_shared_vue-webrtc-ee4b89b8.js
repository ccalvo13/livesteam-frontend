import{importShared as ds}from"./__federation_fn_import.js";import{u as Fe,h as g,a as At}from"./events-c6991436.js";const{defineComponent:Bt,openBlock:ge,createElementBlock:ve,Fragment:ps,renderList:ms,createElementVNode:V,createTextVNode:Pt,toDisplayString:it}=await ds("vue");function _s(s,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in s)){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(s,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}})}),Object.freeze(s)}var ys=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,gs=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],$e=function(e){var t=e,r=e.indexOf("["),n=e.indexOf("]");r!=-1&&n!=-1&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));for(var i=ys.exec(e||""),o={},a=14;a--;)o[gs[a]]=i[a]||"";return r!=-1&&n!=-1&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=vs(o,o.path),o.queryKey=Es(o,o.query),o};function vs(s,e){var t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.substr(0,1)=="/"||e.length===0)&&r.splice(0,1),e.substr(e.length-1,1)=="/"&&r.splice(r.length-1,1),r}function Es(s,e){var t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,n,i){n&&(t[n]=i)}),t}function bs(s,e="",t){let r=s;t=t||typeof location<"u"&&location,s==null&&(s=t.protocol+"//"+t.host),typeof s=="string"&&(s.charAt(0)==="/"&&(s.charAt(1)==="/"?s=t.protocol+s:s=t.host+s),/^(https?|wss?):\/\//.test(s)||(typeof t<"u"?s=t.protocol+"//"+s:s="https://"+s),r=$e(s)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}/**
 * Wrapper for built-in http.js to emulate the browser XMLHttpRequest object.
 *
 * This can be used with JS designed for browsers to improve reuse of code and
 * allow the use of existing libraries.
 *
 * Usage: include("XMLHttpRequest.js") and use XMLHttpRequest per W3C specs.
 *
 * @author Dan DeFelippi <dan@driverdan.com>
 * @contributor David Ellis <d.f.ellis@ieee.org>
 * @license MIT
 */var Ss=g.spawn,Ee=Ve;Ve.XMLHttpRequest=Ve;function Ve(s){s=s||{};var e=this,t=g,r=g,n,i,o={},a=!1,h={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},c=Object.assign({},h),u=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],l=["TRACE","TRACK","CONNECT"],d=!1,y=!1,v=!1,E={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseText="",this.responseXML="",this.status=null,this.statusText=null;var X=function(f){return a||f&&u.indexOf(f.toLowerCase())===-1},se=function(f){return f&&l.indexOf(f)===-1};this.open=function(f,m,C,k,R){if(this.abort(),y=!1,v=!1,!se(f))throw new Error("SecurityError: Request method not allowed");o={method:f,url:m.toString(),async:typeof C!="boolean"?!0:C,user:k||null,password:R||null},T(this.OPENED)},this.setDisableHeaderCheck=function(f){a=f},this.setRequestHeader=function(f,m){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN");if(!X(f))return console.warn('Refused to set unsafe header "'+f+'"'),!1;if(d)throw new Error("INVALID_STATE_ERR: send flag is true");return c[f]=m,!0},this.getResponseHeader=function(f){return typeof f=="string"&&this.readyState>this.OPENED&&i.headers[f.toLowerCase()]&&!y?i.headers[f.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||y)return"";var f="";for(var m in i.headers)m!=="set-cookie"&&m!=="set-cookie2"&&(f+=m+": "+i.headers[m]+`\r
`);return f.substr(0,f.length-2)},this.getRequestHeader=function(f){return typeof f=="string"&&c[f]?c[f]:""},this.send=function(f){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: connection must be opened before send() is called");if(d)throw new Error("INVALID_STATE_ERR: send has already been called");var m=!1,C=!1,k=Fe.parse(o.url),R;switch(k.protocol){case"https:":m=!0;case"http:":R=k.hostname;break;case"file:":C=!0;break;case void 0:case"":R="localhost";break;default:throw new Error("Protocol not supported.")}if(C){if(o.method!=="GET")throw new Error("XMLHttpRequest: Only GET method is supported");if(o.async)g.readFile(unescape(k.pathname),"utf8",function(O,J){O?e.handleError(O,O.errno||-1):(e.status=200,e.responseText=J,T(e.DONE))});else try{this.responseText=g.readFileSync(unescape(k.pathname),"utf8"),this.status=200,T(e.DONE)}catch(O){this.handleError(O,O.errno||-1)}return}var re=k.port||(m?443:80),as=k.pathname+(k.search?k.search:"");if(c.Host=R,m&&re===443||re===80||(c.Host+=":"+k.port),o.user){typeof o.password>"u"&&(o.password="");var cs=new Buffer(o.user+":"+o.password);c.Authorization="Basic "+cs.toString("base64")}o.method==="GET"||o.method==="HEAD"?f=null:f?(c["Content-Length"]=Buffer.isBuffer(f)?f.length:Buffer.byteLength(f),c["Content-Type"]||(c["Content-Type"]="text/plain;charset=UTF-8")):o.method==="POST"&&(c["Content-Length"]=0);var hs=s.agent||!1,I={host:R,port:re,path:as,method:o.method,headers:c,agent:hs};if(m&&(I.pfx=s.pfx,I.key=s.key,I.passphrase=s.passphrase,I.cert=s.cert,I.ca=s.ca,I.ciphers=s.ciphers,I.rejectUnauthorized=s.rejectUnauthorized!==!1),y=!1,o.async){var st=m?r.request:t.request;d=!0,e.dispatchEvent("readystatechange");var rt=function(O){if(i=O,i.statusCode===302||i.statusCode===303||i.statusCode===307){o.url=i.headers.location;var J=Fe.parse(o.url);R=J.hostname;var $={hostname:J.hostname,port:J.port,path:J.path,method:i.statusCode===303?"GET":o.method,headers:c};m&&($.pfx=s.pfx,$.key=s.key,$.passphrase=s.passphrase,$.cert=s.cert,$.ca=s.ca,$.ciphers=s.ciphers,$.rejectUnauthorized=s.rejectUnauthorized!==!1),n=st($,rt).on("error",nt),n.end();return}i&&i.setEncoding&&i.setEncoding("utf8"),T(e.HEADERS_RECEIVED),e.status=i.statusCode,i.on("data",function(me){me&&(e.responseText+=me),d&&T(e.LOADING)}),i.on("end",function(){d&&(d=!1,T(e.DONE))}),i.on("error",function(me){e.handleError(me)})},nt=function(O){e.handleError(O)};n=st(I,rt).on("error",nt),s.autoUnref&&n.on("socket",O=>{O.unref()}),f&&n.write(f),n.end(),e.dispatchEvent("loadstart")}else{var ne=".node-xmlhttprequest-content-"+process.pid,ie=".node-xmlhttprequest-sync-"+process.pid;g.writeFileSync(ie,"","utf8");for(var ls="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+(m?"s":"")+".request;var options = "+JSON.stringify(I)+";var responseText = '';var req = doRequest(options, function(response) {response.setEncoding('utf8');response.on('data', function(chunk) {  responseText += chunk;});response.on('end', function() {fs.writeFileSync('"+ne+"', 'NODE-XMLHTTPREQUEST-STATUS:' + response.statusCode + ',' + responseText, 'utf8');fs.unlinkSync('"+ie+"');});response.on('error', function(error) {fs.writeFileSync('"+ne+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+ie+"');});}).on('error', function(error) {fs.writeFileSync('"+ne+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+ie+"');});"+(f?"req.write('"+JSON.stringify(f).slice(1,-1).replace(/'/g,"\\'")+"');":"")+"req.end();",fs=Ss(process.argv[0],["-e",ls]);g.existsSync(ie););if(e.responseText=g.readFileSync(ne,"utf8"),fs.stdin.end(),g.unlinkSync(ne),e.responseText.match(/^NODE-XMLHTTPREQUEST-ERROR:/)){var us=e.responseText.replace(/^NODE-XMLHTTPREQUEST-ERROR:/,"");e.handleError(us,503)}else e.status=e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:([0-9]*),.*/,"$1"),e.responseText=e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:[0-9]*,(.*)/,"$1"),T(e.DONE)}},this.handleError=function(f,m){this.status=m||0,this.statusText=f,this.responseText=f.stack,y=!0,T(this.DONE)},this.abort=function(){n&&(n.abort(),n=null),c=Object.assign({},h),this.responseText="",this.responseXML="",y=v=!0,this.readyState!==this.UNSENT&&(this.readyState!==this.OPENED||d)&&this.readyState!==this.DONE&&(d=!1,T(this.DONE)),this.readyState=this.UNSENT},this.addEventListener=function(f,m){f in E||(E[f]=[]),E[f].push(m)},this.removeEventListener=function(f,m){f in E&&(E[f]=E[f].filter(function(C){return C!==m}))},this.dispatchEvent=function(f){if(typeof e["on"+f]=="function"&&(this.readyState===this.DONE?setImmediate(function(){e["on"+f]()}):e["on"+f]()),f in E)for(let m=0,C=E[f].length;m<C;m++)this.readyState===this.DONE?setImmediate(function(){E[f][m].call(e)}):E[f][m].call(e)};var T=function(f){if(!(e.readyState===f||e.readyState===e.UNSENT&&v)&&(e.readyState=f,(o.async||e.readyState<e.OPENED||e.readyState===e.DONE)&&e.dispatchEvent("readystatechange"),e.readyState===e.DONE)){let m;v?m="abort":y?m="error":m="load",e.dispatchEvent(m),e.dispatchEvent("loadend")}}}var xs=Object.freeze(_s({__proto__:null,default:Ee,__moduleExports:Ee},[Ee]));const Dt=Ee||xs;var fe=window;function It(s,...e){return e.reduce((t,r)=>(s.hasOwnProperty(r)&&(t[r]=s[r]),t),{})}const ws=setTimeout,Ts=clearTimeout;function Ce(s,e){e.useNativeTimers?(s.setTimeoutFn=ws.bind(fe),s.clearTimeoutFn=Ts.bind(fe)):(s.setTimeoutFn=setTimeout.bind(fe),s.clearTimeoutFn=clearTimeout.bind(fe))}var ee=w;function w(s){if(s)return ks(s)}function ks(s){for(var e in w.prototype)s[e]=w.prototype[e];return s}w.prototype.on=w.prototype.addEventListener=function(s,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+s]=this._callbacks["$"+s]||[]).push(e),this};w.prototype.once=function(s,e){function t(){this.off(s,t),e.apply(this,arguments)}return t.fn=e,this.on(s,t),this};w.prototype.off=w.prototype.removeListener=w.prototype.removeAllListeners=w.prototype.removeEventListener=function(s,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+s];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+s],this;for(var r,n=0;n<t.length;n++)if(r=t[n],r===e||r.fn===e){t.splice(n,1);break}return t.length===0&&delete this._callbacks["$"+s],this};w.prototype.emit=function(s){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+s],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,n=t.length;r<n;++r)t[r].apply(this,e)}return this};w.prototype.emitReserved=w.prototype.emit;w.prototype.listeners=function(s){return this._callbacks=this._callbacks||{},this._callbacks["$"+s]||[]};w.prototype.hasListeners=function(s){return!!this.listeners(s).length};const P=Object.create(null);P.open="0";P.close="1";P.ping="2";P.pong="3";P.message="4";P.upgrade="5";P.noop="6";const be=Object.create(null);Object.keys(P).forEach(s=>{be[P[s]]=s});const Cs={type:"error",data:"parser error"},Ut=({type:s,data:e},t,r)=>{if(e instanceof ArrayBuffer||ArrayBuffer.isView(e)){const n=Os(e);return r(Ns(n,t))}return r(P[s]+(e||""))},Os=s=>Buffer.isBuffer(s)?s:s instanceof ArrayBuffer?Buffer.from(s):Buffer.from(s.buffer,s.byteOffset,s.byteLength),Ns=(s,e)=>e?s:"b"+s.toString("base64"),Mt=(s,e)=>{if(typeof s!="string")return{type:"message",data:ot(s,e)};const t=s.charAt(0);if(t==="b"){const r=Buffer.from(s.substring(1),"base64");return{type:"message",data:ot(r,e)}}return be[t]?s.length>1?{type:be[t],data:s.substring(1)}:{type:be[t]}:Cs},ot=(s,e)=>{const t=Buffer.isBuffer(s);switch(e){case"arraybuffer":return t?Rs(s):s;case"nodebuffer":default:return s}},Rs=s=>{const e=new ArrayBuffer(s.length),t=new Uint8Array(e);for(let r=0;r<s.length;r++)t[r]=s[r];return e},Ft=String.fromCharCode(30),Ls=(s,e)=>{const t=s.length,r=new Array(t);let n=0;s.forEach((i,o)=>{Ut(i,!1,a=>{r[o]=a,++n===t&&e(r.join(Ft))})})},As=(s,e)=>{const t=s.split(Ft),r=[];for(let n=0;n<t.length;n++){const i=Mt(t[n],e);if(r.push(i),i.type==="error")break}return r},$t=4;class Vt extends ee{constructor(e){super(),this.writable=!1,Ce(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t){const r=new Error(e);return r.type="TransportError",r.description=t,super.emit("error",r),this}open(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emit("open")}onData(e){const t=Mt(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emit("packet",e)}onClose(){this.readyState="closed",super.emit("close")}}var qt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),we=64,Wt={},at=0,H=0,ct;function qe(s){var e="";do e=qt[s%we]+e,s=Math.floor(s/we);while(s>0);return e}function Bs(s){var e=0;for(H=0;H<s.length;H++)e=e*we+Wt[s.charAt(H)];return e}function ze(){var s=qe(+new Date);return s!==ct?(at=0,ct=s):s+"."+qe(at++)}for(;H<we;H++)Wt[qt[H]]=H;ze.encode=qe;ze.decode=Bs;var jt=ze,Ps=function(s){var e="";for(var t in s)s.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(s[t]));return e},Ds=function(s){for(var e={},t=s.split("&"),r=0,n=t.length;r<n;r++){var i=t[r].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e},Ye={encode:Ps,decode:Ds};class Is extends Vt{constructor(){super(...arguments),this.polling=!1}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emit("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose(),!1;this.onPacket(r)};As(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emit("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Ls(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emit("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let r="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=jt()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port);const n=Ye.encode(e),i=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(i?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}}function Us(){}const Ms=function(){return new Dt({xdomain:!1}).responseType!=null}();class Fs extends Is{constructor(e){if(super(e),typeof location<"u"){const r=location.protocol==="https:";let n=location.port;n||(n=r?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==r}const t=e&&e.forceBase64;this.supportsBinary=Ms&&!t}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new B(this.uri(),e)}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",n=>{this.onError("xhr post error",n)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",t=>{this.onError("xhr poll error",t)}),this.pollXhr=e}}class B extends ee{constructor(e,t){super(),Ce(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=It(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new Dt(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.opts.extraHeaders[r])}}catch{}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{t.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document<"u"&&(this.index=B.requestsCount++,B.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(e){this.emit("data",e),this.onSuccess()}onError(e){this.emit("error",e),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Us,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete B.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&this.onData(e)}abort(){this.cleanup()}}B.requestsCount=0;B.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",ht);else if(typeof addEventListener=="function"){const s="onpagehide"in fe?"pagehide":"unload";addEventListener(s,ht,!1)}}function ht(){for(let s in B.requests)B.requests.hasOwnProperty(s)&&B.requests[s].abort()}function Ht(s,e,t){return t={path:e,exports:{},require:function(r,n){return $s(r,n??t.path)}},s(t,t.exports),t.exports}function $s(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var Y={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}},de=Ht(function(s){const{EMPTY_BUFFER:e}=Y;function t(a,h){if(a.length===0)return e;if(a.length===1)return a[0];const c=Buffer.allocUnsafe(h);let u=0;for(let l=0;l<a.length;l++){const d=a[l];c.set(d,u),u+=d.length}return u<h?c.slice(0,u):c}function r(a,h,c,u,l){for(let d=0;d<l;d++)c[u+d]=a[d]^h[d&3]}function n(a,h){for(let c=0;c<a.length;c++)a[c]^=h[c&3]}function i(a){return a.byteLength===a.buffer.byteLength?a.buffer:a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)}function o(a){if(o.readOnly=!0,Buffer.isBuffer(a))return a;let h;return a instanceof ArrayBuffer?h=Buffer.from(a):ArrayBuffer.isView(a)?h=Buffer.from(a.buffer,a.byteOffset,a.byteLength):(h=Buffer.from(a),o.readOnly=!1),h}try{const a=require("bufferutil");s.exports={concat:t,mask(h,c,u,l,d){d<48?r(h,c,u,l,d):a.mask(h,c,u,l,d)},toArrayBuffer:i,toBuffer:o,unmask(h,c){h.length<32?n(h,c):a.unmask(h,c)}}}catch{s.exports={concat:t,mask:r,toArrayBuffer:i,toBuffer:o,unmask:n}}});const lt=Symbol("kDone"),Le=Symbol("kRun");class Vs{constructor(e){this[lt]=()=>{this.pending--,this[Le]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[Le]()}[Le](){if(this.pending!==this.concurrency&&this.jobs.length){const e=this.jobs.shift();this.pending++,e(this[lt])}}}var qs=Vs;const{kStatusCode:Gt}=Y,Ws=Buffer.from([0,0,255,255]),Te=Symbol("permessage-deflate"),M=Symbol("total-length"),ue=Symbol("callback"),q=Symbol("buffers"),Se=Symbol("error");let _e;class js{constructor(e,t,r){if(this._maxPayload=r|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!_e){const n=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;_e=new qs(n)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[ue];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,r=e.find(n=>!(t.serverNoContextTakeover===!1&&n.server_no_context_takeover||n.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>n.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!n.client_max_window_bits));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(r.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?r.client_max_window_bits=t.clientMaxWindowBits:(r.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete r.client_max_window_bits,r}acceptAsClient(e){const t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(r=>{let n=t[r];if(n.length>1)throw new Error(`Parameter "${r}" must have only a single value`);if(n=n[0],r==="client_max_window_bits"){if(n!==!0){const i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${r}": ${n}`);n=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${r}": ${n}`)}else if(r==="server_max_window_bits"){const i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${r}": ${n}`);n=i}else if(r==="client_no_context_takeover"||r==="server_no_context_takeover"){if(n!==!0)throw new TypeError(`Invalid value for parameter "${r}": ${n}`)}else throw new Error(`Unknown parameter "${r}"`);t[r]=n})}),e}decompress(e,t,r){_e.add(n=>{this._decompress(e,t,(i,o)=>{n(),r(i,o)})})}compress(e,t,r){_e.add(n=>{this._compress(e,t,(i,o)=>{n(),r(i,o)})})}_decompress(e,t,r){const n=this._isServer?"client":"server";if(!this._inflate){const i=`${n}_max_window_bits`,o=typeof this.params[i]!="number"?g.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=g.createInflateRaw({...this._options.zlibInflateOptions,windowBits:o}),this._inflate[Te]=this,this._inflate[M]=0,this._inflate[q]=[],this._inflate.on("error",Gs),this._inflate.on("data",zt)}this._inflate[ue]=r,this._inflate.write(e),t&&this._inflate.write(Ws),this._inflate.flush(()=>{const i=this._inflate[Se];if(i){this._inflate.close(),this._inflate=null,r(i);return}const o=de.concat(this._inflate[q],this._inflate[M]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[M]=0,this._inflate[q]=[],t&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),r(null,o)})}_compress(e,t,r){const n=this._isServer?"server":"client";if(!this._deflate){const i=`${n}_max_window_bits`,o=typeof this.params[i]!="number"?g.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=g.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:o}),this._deflate[M]=0,this._deflate[q]=[],this._deflate.on("data",Hs)}this._deflate[ue]=r,this._deflate.write(e),this._deflate.flush(g.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=de.concat(this._deflate[q],this._deflate[M]);t&&(i=i.slice(0,i.length-4)),this._deflate[ue]=null,this._deflate[M]=0,this._deflate[q]=[],t&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),r(null,i)})}}var S=js;function Hs(s){this[q].push(s),this[M]+=s.length}function zt(s){if(this[M]+=s.length,this[Te]._maxPayload<1||this[M]<=this[Te]._maxPayload){this[q].push(s);return}this[Se]=new RangeError("Max payload size exceeded"),this[Se].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Se][Gt]=1009,this.removeListener("data",zt),this.reset()}function Gs(s){this[Te]._inflate=null,s[Gt]=1007,this[ue](s)}var Oe=Ht(function(s){const e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function t(n){return n>=1e3&&n<=1014&&n!==1004&&n!==1005&&n!==1006||n>=3e3&&n<=4999}function r(n){const i=n.length;let o=0;for(;o<i;)if(!(n[o]&128))o++;else if((n[o]&224)===192){if(o+1===i||(n[o+1]&192)!==128||(n[o]&254)===192)return!1;o+=2}else if((n[o]&240)===224){if(o+2>=i||(n[o+1]&192)!==128||(n[o+2]&192)!==128||n[o]===224&&(n[o+1]&224)===128||n[o]===237&&(n[o+1]&224)===160)return!1;o+=3}else if((n[o]&248)===240){if(o+3>=i||(n[o+1]&192)!==128||(n[o+2]&192)!==128||(n[o+3]&192)!==128||n[o]===240&&(n[o+1]&240)===128||n[o]===244&&n[o+1]>143||n[o]>244)return!1;o+=4}else return!1;return!0}try{const n=require("utf-8-validate");s.exports={isValidStatusCode:t,isValidUTF8(i){return i.length<150?r(i):n(i)},tokenChars:e}}catch{s.exports={isValidStatusCode:t,isValidUTF8:r,tokenChars:e}}});const{Writable:zs}=g,{BINARY_TYPES:Ys,EMPTY_BUFFER:ft,kStatusCode:Ks,kWebSocket:Xs}=Y,{concat:Ae,toArrayBuffer:Js,unmask:Qs}=de,{isValidStatusCode:Zs,isValidUTF8:ut}=Oe,oe=0,dt=1,pt=2,mt=3,Be=4,er=5;class tr extends zs{constructor(e={}){super(),this._binaryType=e.binaryType||Ys[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[Xs]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=oe,this._loop=!1}_write(e,t,r){if(this._opcode===8&&this._state==oe)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const r=this._buffers[0];return this._buffers[0]=r.slice(e),r.slice(0,e)}const t=Buffer.allocUnsafe(e);do{const r=this._buffers[0],n=t.length-e;e>=r.length?t.set(this._buffers.shift(),n):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),n),this._buffers[0]=r.slice(e)),e-=r.length}while(e>0);return t}startLoop(e){let t;this._loop=!0;do switch(this._state){case oe:t=this.getInfo();break;case dt:t=this.getPayloadLength16();break;case pt:t=this.getPayloadLength64();break;case mt:this.getMask();break;case Be:t=this.getData(e);break;default:this._loop=!1;return}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}const e=this.consume(2);if(e[0]&48)return this._loop=!1,b(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");const t=(e[0]&64)===64;if(t&&!this._extensions[S.extensionName])return this._loop=!1,b(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(t)return this._loop=!1,b(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,b(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,b(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=t}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,b(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(t)return this._loop=!1,b(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125)return this._loop=!1,b(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}else return this._loop=!1,b(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._isServer){if(!this._masked)return this._loop=!1,b(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,b(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(this._payloadLength===126)this._state=dt;else if(this._payloadLength===127)this._state=pt;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}const e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,53-32)-1?(this._loop=!1,b(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,b(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=mt:this._state=Be}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=Be}getData(e){let t=ft;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&Qs(t,this._mask)}if(this._opcode>7)return this.controlMessage(t);if(this._compressed){this._state=er,this.decompress(t,e);return}return t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage()}decompress(e,t){this._extensions[S.extensionName].decompress(e,this._fin,(n,i)=>{if(n)return t(n);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(b(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(i)}const o=this.dataMessage();if(o)return t(o);this.startLoop(t)})}dataMessage(){if(this._fin){const e=this._messageLength,t=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let r;this._binaryType==="nodebuffer"?r=Ae(t,e):this._binaryType==="arraybuffer"?r=Js(Ae(t,e)):r=t,this.emit("message",r,!0)}else{const r=Ae(t,e);if(!this._skipUTF8Validation&&!ut(r))return this._loop=!1,b(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",r,!1)}}this._state=oe}controlMessage(e){if(this._opcode===8)if(this._loop=!1,e.length===0)this.emit("conclude",1005,ft),this.end();else{if(e.length===1)return b(RangeError,"invalid payload length 1",!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");{const t=e.readUInt16BE(0);if(!Zs(t))return b(RangeError,`invalid status code ${t}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");const r=e.slice(2);if(!this._skipUTF8Validation&&!ut(r))return b(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",t,r),this.end()}}else this._opcode===9?this.emit("ping",e):this.emit("pong",e);this._state=oe}}var Yt=tr;function b(s,e,t,r,n){const i=new s(t?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(i,b),i.code=n,i[Ks]=r,i}const{randomFillSync:sr}=g,{EMPTY_BUFFER:rr}=Y,{isValidStatusCode:nr}=Oe,{mask:_t,toBuffer:U}=de,G=Buffer.alloc(4);class W{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){const r=t.mask&&t.readOnly;let n=t.mask?6:2,i=e.length;e.length>=65536?(n+=8,i=127):e.length>125&&(n+=2,i=126);const o=Buffer.allocUnsafe(r?e.length+n:n);return o[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(o[0]|=64),o[1]=i,i===126?o.writeUInt16BE(e.length,2):i===127&&(o.writeUInt32BE(0,2),o.writeUInt32BE(e.length,6)),t.mask?(sr(G,0,4),o[1]|=128,o[n-4]=G[0],o[n-3]=G[1],o[n-2]=G[2],o[n-1]=G[3],r?(_t(e,G,o,n,e.length),[o]):(_t(e,G,e,0,e.length),[o,e])):[o,e]}close(e,t,r,n){let i;if(e===void 0)i=rr;else{if(typeof e!="number"||!nr(e))throw new TypeError("First argument must be a valid error code number");if(t===void 0||!t.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0);else{const o=Buffer.byteLength(t);if(o>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+o),i.writeUInt16BE(e,0),typeof t=="string"?i.write(t,2):i.set(t,2)}}this._deflating?this.enqueue([this.doClose,i,r,n]):this.doClose(i,r,n)}doClose(e,t,r){this.sendFrame(W.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),r)}ping(e,t,r){const n=U(e);if(n.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPing,n,t,U.readOnly,r]):this.doPing(n,t,U.readOnly,r)}doPing(e,t,r,n){this.sendFrame(W.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:r}),n)}pong(e,t,r){const n=U(e);if(n.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPong,n,t,U.readOnly,r]):this.doPong(n,t,U.readOnly,r)}doPong(e,t,r,n){this.sendFrame(W.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:r}),n)}send(e,t,r){const n=U(e),i=this._extensions[S.extensionName];let o=t.binary?2:1,a=t.compress;if(this._firstFragment?(this._firstFragment=!1,a&&i&&i.params[i._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(a=n.length>=i._threshold),this._compress=a):(a=!1,o=0),t.fin&&(this._firstFragment=!0),i){const h={fin:t.fin,rsv1:a,opcode:o,mask:t.mask,readOnly:U.readOnly};this._deflating?this.enqueue([this.dispatch,n,this._compress,h,r]):this.dispatch(n,this._compress,h,r)}else this.sendFrame(W.frame(n,{fin:t.fin,rsv1:!1,opcode:o,mask:t.mask,readOnly:U.readOnly}),r)}dispatch(e,t,r,n){if(!t){this.sendFrame(W.frame(e,r),n);return}const i=this._extensions[S.extensionName];this._bufferedBytes+=e.length,this._deflating=!0,i.compress(e,r.fin,(o,a)=>{if(this._socket.destroyed){const h=new Error("The socket was closed while data was being compressed");typeof n=="function"&&n(h);for(let c=0;c<this._queue.length;c++){const u=this._queue[c][4];typeof u=="function"&&u(h)}return}this._bufferedBytes-=e.length,this._deflating=!1,r.readOnly=!1,this.sendFrame(W.frame(a,r),n),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[1].length,Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}var Kt=W;const{kForOnEventAttribute:Pe,kListener:yt}=Y,gt=Symbol("kCode"),vt=Symbol("kData"),Et=Symbol("kError"),bt=Symbol("kMessage"),St=Symbol("kReason"),Z=Symbol("kTarget"),xt=Symbol("kType"),wt=Symbol("kWasClean");class K{constructor(e){this[Z]=null,this[xt]=e}get target(){return this[Z]}get type(){return this[xt]}}Object.defineProperty(K.prototype,"target",{enumerable:!0});Object.defineProperty(K.prototype,"type",{enumerable:!0});class pe extends K{constructor(e,t={}){super(e),this[gt]=t.code===void 0?0:t.code,this[St]=t.reason===void 0?"":t.reason,this[wt]=t.wasClean===void 0?!1:t.wasClean}get code(){return this[gt]}get reason(){return this[St]}get wasClean(){return this[wt]}}Object.defineProperty(pe.prototype,"code",{enumerable:!0});Object.defineProperty(pe.prototype,"reason",{enumerable:!0});Object.defineProperty(pe.prototype,"wasClean",{enumerable:!0});class Ne extends K{constructor(e,t={}){super(e),this[Et]=t.error===void 0?null:t.error,this[bt]=t.message===void 0?"":t.message}get error(){return this[Et]}get message(){return this[bt]}}Object.defineProperty(Ne.prototype,"error",{enumerable:!0});Object.defineProperty(Ne.prototype,"message",{enumerable:!0});class Ke extends K{constructor(e,t={}){super(e),this[vt]=t.data===void 0?null:t.data}get data(){return this[vt]}}Object.defineProperty(Ke.prototype,"data",{enumerable:!0});const ir={addEventListener(s,e,t={}){let r;if(s==="message")r=function(i,o){const a=new Ke("message",{data:o?i:i.toString()});a[Z]=this,e.call(this,a)};else if(s==="close")r=function(i,o){const a=new pe("close",{code:i,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[Z]=this,e.call(this,a)};else if(s==="error")r=function(i){const o=new Ne("error",{error:i,message:i.message});o[Z]=this,e.call(this,o)};else if(s==="open")r=function(){const i=new K("open");i[Z]=this,e.call(this,i)};else return;r[Pe]=!!t[Pe],r[yt]=e,t.once?this.once(s,r):this.on(s,r)},removeEventListener(s,e){for(const t of this.listeners(s))if(t[yt]===e&&!t[Pe]){this.removeListener(s,t);break}}};var or={CloseEvent:pe,ErrorEvent:Ne,Event:K,EventTarget:ir,MessageEvent:Ke};const{tokenChars:ae}=Oe;function A(s,e,t){s[e]===void 0?s[e]=[t]:s[e].push(t)}function ar(s){const e=Object.create(null);let t=Object.create(null),r=!1,n=!1,i=!1,o,a,h=-1,c=-1,u=-1,l=0;for(;l<s.length;l++)if(c=s.charCodeAt(l),o===void 0)if(u===-1&&ae[c]===1)h===-1&&(h=l);else if(l!==0&&(c===32||c===9))u===-1&&h!==-1&&(u=l);else if(c===59||c===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${l}`);u===-1&&(u=l);const y=s.slice(h,u);c===44?(A(e,y,t),t=Object.create(null)):o=y,h=u=-1}else throw new SyntaxError(`Unexpected character at index ${l}`);else if(a===void 0)if(u===-1&&ae[c]===1)h===-1&&(h=l);else if(c===32||c===9)u===-1&&h!==-1&&(u=l);else if(c===59||c===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${l}`);u===-1&&(u=l),A(t,s.slice(h,u),!0),c===44&&(A(e,o,t),t=Object.create(null),o=void 0),h=u=-1}else if(c===61&&h!==-1&&u===-1)a=s.slice(h,l),h=u=-1;else throw new SyntaxError(`Unexpected character at index ${l}`);else if(n){if(ae[c]!==1)throw new SyntaxError(`Unexpected character at index ${l}`);h===-1?h=l:r||(r=!0),n=!1}else if(i)if(ae[c]===1)h===-1&&(h=l);else if(c===34&&h!==-1)i=!1,u=l;else if(c===92)n=!0;else throw new SyntaxError(`Unexpected character at index ${l}`);else if(c===34&&s.charCodeAt(l-1)===61)i=!0;else if(u===-1&&ae[c]===1)h===-1&&(h=l);else if(h!==-1&&(c===32||c===9))u===-1&&(u=l);else if(c===59||c===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${l}`);u===-1&&(u=l);let y=s.slice(h,u);r&&(y=y.replace(/\\/g,""),r=!1),A(t,a,y),c===44&&(A(e,o,t),t=Object.create(null),o=void 0),a=void 0,h=u=-1}else throw new SyntaxError(`Unexpected character at index ${l}`);if(h===-1||i||c===32||c===9)throw new SyntaxError("Unexpected end of input");u===-1&&(u=l);const d=s.slice(h,u);return o===void 0?A(e,d,t):(a===void 0?A(t,d,!0):r?A(t,a,d.replace(/\\/g,"")):A(t,a,d),A(e,o,t)),e}function cr(s){return Object.keys(s).map(e=>{let t=s[e];return Array.isArray(t)||(t=[t]),t.map(r=>[e].concat(Object.keys(r).map(n=>{let i=r[n];return Array.isArray(i)||(i=[i]),i.map(o=>o===!0?n:`${n}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}var We={format:cr,parse:ar};const{randomBytes:hr,createHash:lr}=g,{URL:De}=Fe,{BINARY_TYPES:Tt,EMPTY_BUFFER:ye,GUID:fr,kForOnEventAttribute:Ie,kListener:ur,kStatusCode:dr,kWebSocket:x,NOOP:Xt}=Y,{EventTarget:{addEventListener:pr,removeEventListener:mr}}=or,{format:_r,parse:yr}=We,{toBuffer:gr}=de,F=["CONNECTING","OPEN","CLOSING","CLOSED"],vr=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,Ue=[8,13],Er=30*1e3;class p extends At{constructor(e,t,r){super(),this._binaryType=Tt[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=ye,this._closeTimer=null,this._extensions={},this._protocol="",this._readyState=p.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,t===void 0?t=[]:Array.isArray(t)||(typeof t=="object"&&t!==null?(r=t,t=[]):t=[t]),Jt(this,e,t,r)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(e){Tt.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){const n=new Yt({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation});this._sender=new Kt(e,this._extensions),this._receiver=n,this._socket=e,n[x]=this,e[x]=this,n.on("conclude",xr),n.on("drain",wr),n.on("error",Tr),n.on("message",kr),n.on("ping",Cr),n.on("pong",Or),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",Zt),e.on("data",Re),e.on("end",es),e.on("error",ts),this._readyState=p.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=p.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[S.extensionName]&&this._extensions[S.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=p.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==p.CLOSED){if(this.readyState===p.CONNECTING){const r="WebSocket was closed before the connection was established";return N(this,this._req,r)}if(this.readyState===p.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=p.CLOSING,this._sender.close(e,t,!this._isServer,r=>{r||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),Er)}}ping(e,t,r){if(this.readyState===p.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==p.OPEN){Me(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.ping(e||ye,t,r)}pong(e,t,r){if(this.readyState===p.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==p.OPEN){Me(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.pong(e||ye,t,r)}send(e,t,r){if(this.readyState===p.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"&&(r=t,t={}),typeof e=="number"&&(e=e.toString()),this.readyState!==p.OPEN){Me(this,e,r);return}const n={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[S.extensionName]||(n.compress=!1),this._sender.send(e||ye,n,r)}terminate(){if(this.readyState!==p.CLOSED){if(this.readyState===p.CONNECTING){const e="WebSocket was closed before the connection was established";return N(this,this._req,e)}this._socket&&(this._readyState=p.CLOSING,this._socket.destroy())}}}Object.defineProperty(p,"CONNECTING",{enumerable:!0,value:F.indexOf("CONNECTING")});Object.defineProperty(p.prototype,"CONNECTING",{enumerable:!0,value:F.indexOf("CONNECTING")});Object.defineProperty(p,"OPEN",{enumerable:!0,value:F.indexOf("OPEN")});Object.defineProperty(p.prototype,"OPEN",{enumerable:!0,value:F.indexOf("OPEN")});Object.defineProperty(p,"CLOSING",{enumerable:!0,value:F.indexOf("CLOSING")});Object.defineProperty(p.prototype,"CLOSING",{enumerable:!0,value:F.indexOf("CLOSING")});Object.defineProperty(p,"CLOSED",{enumerable:!0,value:F.indexOf("CLOSED")});Object.defineProperty(p.prototype,"CLOSED",{enumerable:!0,value:F.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","protocol","readyState","url"].forEach(s=>{Object.defineProperty(p.prototype,s,{enumerable:!0})});["open","error","close","message"].forEach(s=>{Object.defineProperty(p.prototype,`on${s}`,{enumerable:!0,get(){for(const e of this.listeners(s))if(e[Ie])return e[ur];return null},set(e){for(const t of this.listeners(s))if(t[Ie]){this.removeListener(s,t);break}typeof e=="function"&&this.addEventListener(s,e,{[Ie]:!0})}})});p.prototype.addEventListener=pr;p.prototype.removeEventListener=mr;var D=p;function Jt(s,e,t,r){const n={protocolVersion:Ue[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...r,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,host:void 0,path:void 0,port:void 0};if(!Ue.includes(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} (supported versions: ${Ue.join(", ")})`);let i;if(e instanceof De)i=e,s._url=e.href;else{try{i=new De(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}s._url=e}const o=i.protocol==="wss:",a=i.protocol==="ws+unix:";if(i.protocol!=="ws:"&&!o&&!a)throw new SyntaxError(`The URL's protocol must be one of "ws:", "wss:", or "ws+unix:"`);if(a&&!i.pathname)throw new SyntaxError("The URL's pathname is empty");if(i.hash)throw new SyntaxError("The URL contains a fragment identifier");const h=o?443:80,c=hr(16).toString("base64"),u=o?g.get:g.get,l=new Set;let d;if(n.createConnection=o?Sr:br,n.defaultPort=n.defaultPort||h,n.port=i.port||h,n.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,n.headers={"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":c,Connection:"Upgrade",Upgrade:"websocket",...n.headers},n.path=i.pathname+i.search,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(d=new S(n.perMessageDeflate!==!0?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=_r({[S.extensionName]:d.offer()})),t.length){for(const v of t){if(typeof v!="string"||!vr.test(v)||l.has(v))throw new SyntaxError("An invalid or duplicated subprotocol was specified");l.add(v)}n.headers["Sec-WebSocket-Protocol"]=t.join(",")}if(n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin),(i.username||i.password)&&(n.auth=`${i.username}:${i.password}`),a){const v=n.path.split(":");n.socketPath=v[0],n.path=v[1]}let y=s._req=u(n);n.timeout&&y.on("timeout",()=>{N(s,y,"Opening handshake has timed out")}),y.on("error",v=>{y===null||y.aborted||(y=s._req=null,s._readyState=p.CLOSING,s.emit("error",v),s.emitClose())}),y.on("response",v=>{const E=v.headers.location,X=v.statusCode;if(E&&n.followRedirects&&X>=300&&X<400){if(++s._redirects>n.maxRedirects){N(s,y,"Maximum redirects exceeded");return}y.abort();const se=new De(E,e);Jt(s,se,t,r)}else s.emit("unexpected-response",y,v)||N(s,y,`Unexpected server response: ${v.statusCode}`)}),y.on("upgrade",(v,E,X)=>{if(s.emit("upgrade",v),s.readyState!==p.CONNECTING)return;y=s._req=null;const se=lr("sha1").update(c+fr).digest("base64");if(v.headers["sec-websocket-accept"]!==se){N(s,E,"Invalid Sec-WebSocket-Accept header");return}const T=v.headers["sec-websocket-protocol"];let f;if(T!==void 0?l.size?l.has(T)||(f="Server sent an invalid subprotocol"):f="Server sent a subprotocol but none was requested":l.size&&(f="Server sent no subprotocol"),f){N(s,E,f);return}T&&(s._protocol=T);const m=v.headers["sec-websocket-extensions"];if(m!==void 0){if(!d){N(s,E,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let C;try{C=yr(m)}catch{N(s,E,"Invalid Sec-WebSocket-Extensions header");return}const k=Object.keys(C);if(k.length!==1||k[0]!==S.extensionName){N(s,E,"Server indicated an extension that was not requested");return}try{d.accept(C[S.extensionName])}catch{N(s,E,"Invalid Sec-WebSocket-Extensions header");return}s._extensions[S.extensionName]=d}s.setSocket(E,X,{maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation})})}function br(s){return s.path=s.socketPath,g.connect(s)}function Sr(s){return s.path=void 0,!s.servername&&s.servername!==""&&(s.servername=g.isIP(s.host)?"":s.host),g.connect(s)}function N(s,e,t){s._readyState=p.CLOSING;const r=new Error(t);Error.captureStackTrace(r,N),e.setHeader?(e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),e.once("abort",s.emitClose.bind(s)),s.emit("error",r)):(e.destroy(r),e.once("error",s.emit.bind(s,"error")),e.once("close",s.emitClose.bind(s)))}function Me(s,e,t){if(e){const r=gr(e).length;s._socket?s._sender._bufferedBytes+=r:s._bufferedAmount+=r}if(t){const r=new Error(`WebSocket is not open: readyState ${s.readyState} (${F[s.readyState]})`);t(r)}}function xr(s,e){const t=this[x];t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=s,t._socket[x]!==void 0&&(t._socket.removeListener("data",Re),process.nextTick(Qt,t._socket),s===1005?t.close():t.close(s,e))}function wr(){this[x]._socket.resume()}function Tr(s){const e=this[x];e._socket[x]!==void 0&&(e._socket.removeListener("data",Re),process.nextTick(Qt,e._socket),e.close(s[dr])),e.emit("error",s)}function kt(){this[x].emitClose()}function kr(s,e){this[x].emit("message",s,e)}function Cr(s){const e=this[x];e.pong(s,!e._isServer,Xt),e.emit("ping",s)}function Or(s){this[x].emit("pong",s)}function Qt(s){s.resume()}function Zt(){const s=this[x];this.removeListener("close",Zt),this.removeListener("data",Re),this.removeListener("end",es),s._readyState=p.CLOSING;let e;!this._readableState.endEmitted&&!s._closeFrameReceived&&!s._receiver._writableState.errorEmitted&&(e=s._socket.read())!==null&&s._receiver.write(e),s._receiver.end(),this[x]=void 0,clearTimeout(s._closeTimer),s._receiver._writableState.finished||s._receiver._writableState.errorEmitted?s.emitClose():(s._receiver.on("error",kt),s._receiver.on("finish",kt))}function Re(s){this[x]._receiver.write(s)||this.pause()}function es(){const s=this[x];s._readyState=p.CLOSING,s._receiver.end(),this.end()}function ts(){const s=this[x];this.removeListener("error",ts),this.on("error",Xt),s&&(s._readyState=p.CLOSING,this.destroy())}const{Duplex:Nr}=g;function Ct(s){s.emit("close")}function Rr(){!this.destroyed&&this._writableState.finished&&this.destroy()}function ss(s){this.removeListener("error",ss),this.destroy(),this.listenerCount("error")===0&&this.emit("error",s)}function Lr(s,e){let t=!0,r=!0;function n(){t&&s._socket.resume()}s.readyState===s.CONNECTING?s.once("open",function(){s._receiver.removeAllListeners("drain"),s._receiver.on("drain",n)}):(s._receiver.removeAllListeners("drain"),s._receiver.on("drain",n));const i=new Nr({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return s.on("message",function(a,h){const c=!h&&i._readableState.objectMode?a.toString():a;i.push(c)||(t=!1,s._socket.pause())}),s.once("error",function(a){i.destroyed||(r=!1,i.destroy(a))}),s.once("close",function(){i.destroyed||i.push(null)}),i._destroy=function(o,a){if(s.readyState===s.CLOSED){a(o),process.nextTick(Ct,i);return}let h=!1;s.once("error",function(u){h=!0,a(u)}),s.once("close",function(){h||a(o),process.nextTick(Ct,i)}),r&&s.terminate()},i._final=function(o){if(s.readyState===s.CONNECTING){s.once("open",function(){i._final(o)});return}s._socket!==null&&(s._socket._writableState.finished?(o(),i._readableState.endEmitted&&i.destroy()):(s._socket.once("finish",function(){o()}),s.close()))},i._read=function(){s.readyState===s.OPEN&&!t&&(t=!0,s._receiver._writableState.needDrain||s._socket.resume())},i._write=function(o,a,h){if(s.readyState===s.CONNECTING){s.once("open",function(){i._write(o,a,h)});return}s.send(o,h)},i.on("end",Rr),i.on("error",ss),i}var Ar=Lr;const{tokenChars:Br}=Oe;function Pr(s){const e=new Set;let t=-1,r=-1,n=0;for(n;n<s.length;n++){const o=s.charCodeAt(n);if(r===-1&&Br[o]===1)t===-1&&(t=n);else if(n!==0&&(o===32||o===9))r===-1&&t!==-1&&(r=n);else if(o===44){if(t===-1)throw new SyntaxError(`Unexpected character at index ${n}`);r===-1&&(r=n);const a=s.slice(t,r);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),t=r=-1}else throw new SyntaxError(`Unexpected character at index ${n}`)}if(t===-1||r!==-1)throw new SyntaxError("Unexpected end of input");const i=s.slice(t,n);if(e.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return e.add(i),e}var Dr={parse:Pr};const{createHash:Ir}=g,{GUID:Ur,kWebSocket:Mr}=Y,Fr=/^[+/0-9A-Za-z]{22}==$/,Ot=0,Nt=1,rs=2;class $r extends At{constructor(e,t){if(super(),e={maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=g.createServer((r,n)=>{const i=g.STATUS_CODES[426];n.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),n.end(i)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const r=this.emit.bind(this,"connection");this._removeListeners=qr(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(n,i,o)=>{this.handleUpgrade(n,i,o,r)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=Ot}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===rs){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(ce,this);return}if(e&&this.once("close",e),this._state!==Nt)if(this._state=Nt,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(ce,this):process.nextTick(ce,this);else{const t=this._server;this._removeListeners(),this._removeListeners=this._server=null,t.close(()=>{ce(this)})}}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,n){t.on("error",je);const i=e.headers["sec-websocket-key"]!==void 0?e.headers["sec-websocket-key"]:!1,o=+e.headers["sec-websocket-version"];if(e.method!=="GET"||e.headers.upgrade.toLowerCase()!=="websocket"||!i||!Fr.test(i)||o!==8&&o!==13||!this.shouldHandle(e))return Q(t,400);const a=e.headers["sec-websocket-protocol"];let h=new Set;if(a!==void 0)try{h=Dr.parse(a)}catch{return Q(t,400)}const c=e.headers["sec-websocket-extensions"],u={};if(this.options.perMessageDeflate&&c!==void 0){const l=new S(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const d=We.parse(c);d[S.extensionName]&&(l.accept(d[S.extensionName]),u[S.extensionName]=l)}catch{return Q(t,400)}}if(this.options.verifyClient){const l={origin:e.headers[`${o===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(l,(d,y,v,E)=>{if(!d)return Q(t,y||401,v,E);this.completeUpgrade(u,i,h,e,t,r,n)});return}if(!this.options.verifyClient(l))return Q(t,401)}this.completeUpgrade(u,i,h,e,t,r,n)}completeUpgrade(e,t,r,n,i,o,a){if(!i.readable||!i.writable)return i.destroy();if(i[Mr])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Ot)return Q(i,503);const c=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Ir("sha1").update(t+Ur).digest("base64")}`],u=new D(null);if(r.size){const l=this.options.handleProtocols?this.options.handleProtocols(r,n):r.values().next().value;l&&(c.push(`Sec-WebSocket-Protocol: ${l}`),u._protocol=l)}if(e[S.extensionName]){const l=e[S.extensionName].params,d=We.format({[S.extensionName]:[l]});c.push(`Sec-WebSocket-Extensions: ${d}`),u._extensions=e}this.emit("headers",c,n),i.write(c.concat(`\r
`).join(`\r
`)),i.removeListener("error",je),u.setSocket(i,o,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(u),u.on("close",()=>{this.clients.delete(u),this._shouldEmitClose&&!this.clients.size&&process.nextTick(ce,this)})),a(u,n)}}var Vr=$r;function qr(s,e){for(const t of Object.keys(e))s.on(t,e[t]);return function(){for(const r of Object.keys(e))s.removeListener(r,e[r])}}function ce(s){s._state=rs,s.emit("close")}function je(){this.destroy()}function Q(s,e,t,r){s.writable&&(t=t||g.STATUS_CODES[e],r={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(t),...r},s.write(`HTTP/1.1 ${e} ${g.STATUS_CODES[e]}\r
`+Object.keys(r).map(n=>`${n}: ${r[n]}`).join(`\r
`)+`\r
\r
`+t)),s.removeListener("error",je),s.destroy()}D.createWebSocketStream=Ar;D.Server=Vr;D.Receiver=Yt;D.Sender=Kt;D.WebSocket=D;D.WebSocketServer=D.Server;var Wr=D;const he=Wr,Rt=!1,jr="nodebuffer",Hr=process.nextTick,Lt=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Xe extends Vt{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,r=Lt?{}:It(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=Rt&&!Lt?t?new he(e,t):new he(e):new he(e,t,r)}catch(n){return this.emit("error",n)}this.ws.binaryType=this.socket.binaryType||jr,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;Ut(r,this.supportsBinary,i=>{const o={};r.options&&(o.compress=r.options.compress),this.opts.perMessageDeflate&&(typeof i=="string"?Buffer.byteLength(i):i.length)<this.opts.perMessageDeflate.threshold&&(o.compress=!1);try{Rt||this.ws.send(i,o)}catch{}n&&Hr(()=>{this.writable=!0,this.emit("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let r="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=jt()),this.supportsBinary||(e.b64=1);const n=Ye.encode(e),i=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(i?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(n.length?"?"+n:"")}check(){return!!he&&!("__initialize"in he&&this.name===Xe.prototype.name)}}const Gr={websocket:Xe,polling:Fs};class j extends ee{constructor(e,t={}){super(),e&&typeof e=="object"&&(t=e,e=null),e?(e=$e(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=$e(t.host).host),Ce(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+"/",typeof this.opts.query=="string"&&(this.opts.query=Ye.decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close")},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=zr(this.opts.query);t.EIO=$t,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Gr[e](r)}open(){let e;if(this.opts.rememberUpgrade&&j.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",()=>{this.onClose("transport close")})}probe(e){let t=this.createTransport(e),r=!1;j.priorWebsocketSuccess=!1;const n=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",l=>{if(!r)if(l.type==="pong"&&l.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;j.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const d=new Error("probe error");d.transport=t.name,this.emitReserved("upgradeError",d)}}))};function i(){r||(r=!0,u(),t.close(),t=null)}const o=l=>{const d=new Error("probe error: "+l);d.transport=t.name,i(),this.emitReserved("upgradeError",d)};function a(){o("transport closed")}function h(){o("socket closed")}function c(l){t&&l.name!==t.name&&i()}const u=()=>{t.removeListener("open",n),t.removeListener("error",o),t.removeListener("close",a),this.off("close",h),this.off("upgrading",c)};t.once("open",n),t.once("error",o),t.once("close",a),this.once("close",h),this.once("upgrading",c),t.open()}onOpen(){if(this.readyState="open",j.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade&&this.transport.pause){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,n){if(typeof t=="function"&&(n=t,t=void 0),typeof r=="function"&&(n=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const i={type:e,data:t,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){j.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let r=0;const n=e.length;for(;r<n;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}j.protocol=$t;function zr(s){const e={};for(let t in s)s.hasOwnProperty(t)&&(e[t]=s[t]);return e}const Yr=typeof ArrayBuffer=="function",Kr=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s.buffer instanceof ArrayBuffer,ns=Object.prototype.toString,Xr=typeof Blob=="function"||typeof Blob<"u"&&ns.call(Blob)==="[object BlobConstructor]",Jr=typeof File=="function"||typeof File<"u"&&ns.call(File)==="[object FileConstructor]";function Je(s){return Yr&&(s instanceof ArrayBuffer||Kr(s))||Xr&&s instanceof Blob||Jr&&s instanceof File}function xe(s,e){if(!s||typeof s!="object")return!1;if(Array.isArray(s)){for(let t=0,r=s.length;t<r;t++)if(xe(s[t]))return!0;return!1}if(Je(s))return!0;if(s.toJSON&&typeof s.toJSON=="function"&&arguments.length===1)return xe(s.toJSON(),!0);for(const t in s)if(Object.prototype.hasOwnProperty.call(s,t)&&xe(s[t]))return!0;return!1}function Qr(s){const e=[],t=s.data,r=s;return r.data=He(t,e),r.attachments=e.length,{packet:r,buffers:e}}function He(s,e){if(!s)return s;if(Je(s)){const t={_placeholder:!0,num:e.length};return e.push(s),t}else if(Array.isArray(s)){const t=new Array(s.length);for(let r=0;r<s.length;r++)t[r]=He(s[r],e);return t}else if(typeof s=="object"&&!(s instanceof Date)){const t={};for(const r in s)s.hasOwnProperty(r)&&(t[r]=He(s[r],e));return t}return s}function Zr(s,e){return s.data=Ge(s.data,e),s.attachments=void 0,s}function Ge(s,e){if(!s)return s;if(s&&s._placeholder)return e[s.num];if(Array.isArray(s))for(let t=0;t<s.length;t++)s[t]=Ge(s[t],e);else if(typeof s=="object")for(const t in s)s.hasOwnProperty(t)&&(s[t]=Ge(s[t],e));return s}const is=5;var _;(function(s){s[s.CONNECT=0]="CONNECT",s[s.DISCONNECT=1]="DISCONNECT",s[s.EVENT=2]="EVENT",s[s.ACK=3]="ACK",s[s.CONNECT_ERROR=4]="CONNECT_ERROR",s[s.BINARY_EVENT=5]="BINARY_EVENT",s[s.BINARY_ACK=6]="BINARY_ACK"})(_||(_={}));class en{encode(e){return(e.type===_.EVENT||e.type===_.ACK)&&xe(e)?(e.type=e.type===_.EVENT?_.BINARY_EVENT:_.BINARY_ACK,this.encodeAsBinary(e)):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===_.BINARY_EVENT||e.type===_.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data)),t}encodeAsBinary(e){const t=Qr(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}}class Qe extends ee{constructor(){super()}add(e){let t;if(typeof e=="string")t=this.decodeString(e),t.type===_.BINARY_EVENT||t.type===_.BINARY_ACK?(this.reconstructor=new sn(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t);else if(Je(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(_[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===_.BINARY_EVENT||r.type===_.BINARY_ACK){const i=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(i,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(t+1)==="/"){const i=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(i,t)}else r.nsp="/";const n=e.charAt(t+1);if(n!==""&&Number(n)==n){const i=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}r.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=tn(e.substr(t));if(Qe.isPayloadValid(r.type,i))r.data=i;else throw new Error("invalid payload")}return r}static isPayloadValid(e,t){switch(e){case _.CONNECT:return typeof t=="object";case _.DISCONNECT:return t===void 0;case _.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case _.EVENT:case _.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case _.ACK:case _.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}function tn(s){try{return JSON.parse(s)}catch{return!1}}class sn{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=Zr(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}var rn=Object.freeze({__proto__:null,protocol:is,get PacketType(){return _},Encoder:en,Decoder:Qe});function L(s,e,t){return s.on(e,t),function(){s.off(e,t)}}const nn=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Ze extends ee{constructor(e,t,r){super(),this.connected=!1,this.disconnected=!0,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this.io._autoConnect&&this.open()}subEvents(){if(this.subs)return;const e=this.io;this.subs=[L(e,"open",this.onopen.bind(this)),L(e,"packet",this.onpacket.bind(this)),L(e,"error",this.onerror.bind(this)),L(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(nn.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');t.unshift(e);const r={type:_.EVENT,data:t};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const o=this.ids++,a=t.pop();this._registerAckCallback(o,a),r.id=o}const n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!n||!this.connected)||(this.connected?this.packet(r):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){const r=this.flags.timeout;if(r===void 0){this.acks[e]=t;return}const n=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let i=0;i<this.sendBuffer.length;i++)this.sendBuffer[i].id===e&&this.sendBuffer.splice(i,1);t.call(this,new Error("operation has timed out"))},r);this.acks[e]=(...i)=>{this.io.clearTimeoutFn(n),t.apply(this,[null,...i])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this.packet({type:_.CONNECT,data:e})}):this.packet({type:_.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e){this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",e)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case _.CONNECT:if(e.data&&e.data.sid){const n=e.data.sid;this.onconnect(n)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case _.EVENT:this.onevent(e);break;case _.BINARY_EVENT:this.onevent(e);break;case _.ACK:this.onack(e);break;case _.BINARY_ACK:this.onack(e);break;case _.DISCONNECT:this.ondisconnect();break;case _.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let r=!1;return function(...n){r||(r=!0,t.packet({type:_.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>this.packet(e)),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:_.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}var on=te;function te(s){s=s||{},this.ms=s.min||100,this.max=s.max||1e4,this.factor=s.factor||2,this.jitter=s.jitter>0&&s.jitter<=1?s.jitter:0,this.attempts=0}te.prototype.duration=function(){var s=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*s);s=Math.floor(e*10)&1?s+t:s-t}return Math.min(s,this.max)|0};te.prototype.reset=function(){this.attempts=0};te.prototype.setMin=function(s){this.ms=s};te.prototype.setMax=function(s){this.max=s};te.prototype.setJitter=function(s){this.jitter=s};class ke extends ee{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Ce(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new on({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const n=t.parser||rn;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new j(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=L(t,"open",function(){r.onopen(),e&&e()}),i=L(t,"error",o=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",o),e?e(o):r.maybeReconnectOnOpen()});if(this._timeout!==!1){const o=this._timeout;o===0&&n();const a=this.setTimeoutFn(()=>{n(),t.close(),t.emit("error",new Error("timeout"))},o);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}return this.subs.push(n),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(L(e,"ping",this.onping.bind(this)),L(e,"data",this.ondata.bind(this)),L(e,"error",this.onerror.bind(this)),L(e,"close",this.onclose.bind(this)),L(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){this.decoder.add(e)}ondecoded(e){this.emitReserved("packet",e)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r||(r=new Ze(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(n=>{n?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",n)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const le={};function z(s,e){typeof s=="object"&&(e=s,s=void 0),e=e||{};const t=bs(s,e.path||"/socket.io"),r=t.source,n=t.id,i=t.path,o=le[n]&&i in le[n].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let h;return a?h=new ke(r,e):(le[n]||(le[n]=new ke(r,e)),h=le[n]),t.query&&!e.query&&(e.query=t.queryKey),h.socket(t.path,e)}Object.assign(z,{Manager:ke,Socket:Ze,io:z,connect:z});var an=Object.freeze({__proto__:null,Manager:ke,Socket:Ze,io:z,connect:z,default:z,protocol:is});const cn=require("simple-signal-client");var et=Bt({name:"vue-webrtc",components:{},data(){return{signalClient:null,videoList:[],canvas:null,socket:null}},props:{roomId:{type:String,default:"public-room-v2"},socketURL:{type:String,default:"https://weston-vue-webrtc-lobby.azurewebsites.net"},cameraHeight:{type:[Number,String],default:160},autoplay:{type:Boolean,default:!0},screenshotFormat:{type:String,default:"image/jpeg"},enableAudio:{type:Boolean,default:!0},enableVideo:{type:Boolean,default:!0},enableLogs:{type:Boolean,default:!1},peerOptions:{type:Object,default(){return{}}},ioOptions:{type:Object,default(){return{rejectUnauthorized:!1,transports:["polling","websocket"]}}},deviceId:{type:String,default:null}},watch:{},mounted(){},methods:{async join(){var s=this;this.log("join"),this.socket=z(this.socketURL,this.ioOptions),this.signalClient=new cn(this.socket);let e={video:s.enableVideo,audio:s.enableAudio};s.deviceId&&s.enableVideo&&(e.video={deviceId:{exact:s.deviceId}});const t=await navigator.mediaDevices.getUserMedia(e);this.log("opened",t),this.joinedRoom(t,!0),this.signalClient.once("discover",r=>{s.log("discovered",r);async function n(i){if(i!=s.socket.id)try{s.log("Connecting to peer");const{peer:o}=await s.signalClient.connect(i,s.roomId,s.peerOptions);s.videoList.forEach(a=>{a.isLocal&&s.onPeer(o,a.stream)})}catch{s.log("Error connecting to peer")}}r.peers.forEach(i=>n(i)),s.$emit("opened-room",s.roomId)}),this.signalClient.on("request",async r=>{s.log("requested",r);const{peer:n}=await r.accept({},s.peerOptions);s.log("accepted",n),s.videoList.forEach(i=>{i.isLocal&&s.onPeer(n,i.stream)})}),this.signalClient.discover(s.roomId)},onPeer(s,e){var t=this;t.log("onPeer"),s.addStream(e),s.on("stream",r=>{t.joinedRoom(r,!1),s.on("close",()=>{var n=[];t.videoList.forEach(function(i){i.id!==r.id&&n.push(i)}),t.videoList=n,t.$emit("left-room",r.id)}),s.on("error",n=>{t.log("peer error ",n)})})},joinedRoom(s,e){var t=this;if(t.videoList.find(n=>n.id===s.id)===void 0){let n={id:s.id,muted:e,stream:s,isLocal:e};t.videoList.push(n)}setTimeout(function(){for(var n=0,i=t.$refs.videos.length;n<i;n++)if(t.$refs.videos[n].id===s.id){t.$refs.videos[n].srcObject=s;break}},500),t.$emit("joined-room",s.id)},leave(){this.videoList.forEach(s=>s.stream.getTracks().forEach(e=>e.stop())),this.videoList=[],this.signalClient.peers().forEach(s=>s.removeAllListeners()),this.signalClient.destroy(),this.signalClient=null,this.socket.destroy(),this.socket=null},capture(){return this.getCanvas().toDataURL(this.screenshotFormat)},getCanvas(){let s=this.$refs.videos[0];if(s!==null&&!this.ctx){let r=document.createElement("canvas");r.height=s.clientHeight,r.width=s.clientWidth,this.canvas=r,this.ctx=r.getContext("2d")}const{ctx:e,canvas:t}=this;return e.drawImage(s,0,0,t.width,t.height),t},async shareScreen(){var s=this;if(navigator.mediaDevices==null){s.log("Error: https is required to load cameras");return}try{var e=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1});this.joinedRoom(e,!0),s.$emit("share-started",e.id),s.signalClient.peers().forEach(t=>s.onPeer(t,e))}catch(t){s.log("Media error: "+JSON.stringify(t))}},log(s,e){this.enableLogs&&(console.log(s),e!=null&&console.log(e))}}});const hn={class:"video-list"},ln=["video"],fn=["height","muted","id"];function un(s,e,t,r,n,i){return ge(),ve("div",hn,[(ge(!0),ve(ps,null,ms(s.videoList,o=>(ge(),ve("div",{video:o,key:o.id,class:"video-item"},[V("video",{controls:"",autoplay:"",playsinline:"",ref_for:!0,ref:"videos",height:s.cameraHeight,muted:o.muted,id:o.id},null,8,fn)],8,ln))),128))])}function os(s,e){e===void 0&&(e={});var t=e.insertAt;if(!(!s||typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=s:n.appendChild(document.createTextNode(s))}}var dn=`
.video-list[data-v-41044b41] {\r
        background: whitesmoke;\r
        height: auto;\r
        display: flex;\r
        flex-direction: row;\r
        justify-content: center;\r
        flex-wrap: wrap;
}
.video-list div[data-v-41044b41] {\r
            padding: 0px;
}
.video-item[data-v-41044b41] {\r
        background: #c5c4c4;\r
        display: inline-block;
}\r
`;os(dn);et.render=un;et.__scopeId="data-v-41044b41";var tt=Bt({name:"VueWebrtcSample",data(){return{counter:5,initCounter:5,message:{action:null,amount:null}}},computed:{changedBy(){const{message:s}=this;return s.action?`${s.action} ${s.amount||""}`.trim():"initialized"}},methods:{increment(s){const e=typeof s!="number"?1:s;this.counter+=e,this.message.action="incremented by",this.message.amount=e},decrement(s){const e=typeof s!="number"?1:s;this.counter-=e,this.message.action="decremented by",this.message.amount=e},reset(){this.counter=this.initCounter,this.message.action="reset",this.message.amount=null}}});const pn={class:"vue-webrtc-sample"},mn=Pt(".");function _n(s,e,t,r,n,i){return ge(),ve("div",pn,[V("p",null,[Pt("The counter was "+it(s.changedBy)+" to ",1),V("b",null,it(s.counter),1),mn]),V("button",{onClick:e[0]||(e[0]=function(){return s.increment&&s.increment(...arguments)})}," Click +1 "),V("button",{onClick:e[1]||(e[1]=function(){return s.decrement&&s.decrement(...arguments)})}," Click -1 "),V("button",{onClick:e[2]||(e[2]=o=>s.increment(5))}," Click +5 "),V("button",{onClick:e[3]||(e[3]=o=>s.decrement(5))}," Click -5 "),V("button",{onClick:e[4]||(e[4]=function(){return s.reset&&s.reset(...arguments)})}," Reset ")])}var yn=`
.vue-webrtc-sample[data-v-3020e3b4] {\r
    display: block;\r
    width: 400px;\r
    margin: 25px auto;\r
    border: 1px solid #ccc;\r
    background: #eaeaea;\r
    text-align: center;\r
    padding: 25px;
}
.vue-webrtc-sample p[data-v-3020e3b4] {\r
    margin: 0 0 1em;
}\r
`;os(yn);tt.render=_n;tt.__scopeId="data-v-3020e3b4";window.io=an;var gn=Object.freeze({__proto__:null,VueWebRTC:et,VueWebrtcSample:tt});const bn=function(e){Object.entries(gn).forEach(t=>{let[r,n]=t;e.component(r,n)})};export{et as VueWebRTC,tt as VueWebrtcSample,bn as default};
